<!DOCTYPE html><html class=writer-html5 lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content=bebo><link rel="shortcut icon" href=../../img/favicon.ico><title>Rate Limiting - Opossum Search Documentation</title><link rel=stylesheet href=../../css/theme.css><link rel=stylesheet href=../../css/theme_extra.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css><script>
        // Current page data
        var mkdocs_page_name = "Rate Limiting";
        var mkdocs_page_input_path = "service-availability\\rate-limiting-throttling.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js></script><script>hljs.highlightAll();</script></head> <body class=wy-body-for-nav role=document> <div class=wy-grid-for-nav> <nav data-toggle=wy-nav-shift class="wy-nav-side stickynav"> <div class=wy-side-scroll> <div class=wy-side-nav-search> <a href=../.. class="icon icon-home"> Opossum Search Documentation </a><div role=search> <form id=rtd-search-form class=wy-form action=../../search.html method=get> <input type=text name=q placeholder="Search docs" aria-label="Search docs" title="Type search term here"> </form> </div> </div> <div class="wy-menu wy-menu-vertical" data-spy=affix role=navigation aria-label="Navigation menu"> <ul> <li class=toctree-l1><a class="reference internal" href=../..>Home</a> </li> </ul> <p class=caption><span class=caption-text>Service Availability</span></p> <ul class=current> <li class=toctree-l1><a href=../context-and-scope/ class="reference internal">Context and Scope</a> </li> <li class=toctree-l1><a href=../quality-requirements/ class="reference internal">Quality Requirements</a> </li> <li class=toctree-l1><a href=../architecture-constraints/ class="reference internal">Architecture Constraints</a> </li> <li class=toctree-l1><a href=../availability-monitoring/ class="reference internal">Availability Monitoring</a> </li> <li class=toctree-l1><a href=../service-outage/ class="reference internal">Error Handling</a> </li> <li class="toctree-l1 current"><a class="reference internal current" href=#>Rate Limiting</a> <ul class=current> <li class=toctree-l2><a class="reference internal" href=#61-rate-limit-policies>6.1 Rate Limit Policies</a> </li> <li class=toctree-l2><a class="reference internal" href=#62-detection-mechanisms>6.2 Detection Mechanisms</a> </li> <li class=toctree-l2><a class="reference internal" href=#63-request-management>6.3 Request Management</a> </li> <li class=toctree-l2><a class="reference internal" href=#64-throttling-implementation>6.4 Throttling Implementation</a> </li> <li class=toctree-l2><a class="reference internal" href=#65-client-side-adaptation>6.5 Client-Side Adaptation</a> </li> <li class=toctree-l2><a class="reference internal" href=#66-balance-and-optimization-strategies>6.6 Balance and Optimization Strategies</a> </li> <li class=toctree-l2><a class="reference internal" href=#67-monitoring-and-alerts>6.7 Monitoring and Alerts</a> </li> </ul> </li> <li class=toctree-l1><a href=../log-alerts/ class="reference internal">Logging and Alerts</a> </li> <li class=toctree-l1><a href=../fallback-mechanisms/ class="reference internal">Fallback Mechanisms</a> </li> <li class=toctree-l1><a href=../testing-validation/ class="reference internal">Testing and Validation</a> </li> <li class=toctree-l1><a href=../processing-diagrams/ class="reference internal">Diagrams</a> </li> </ul> </div> </div> </nav> <section data-toggle=wy-nav-shift class=wy-nav-content-wrap> <nav class=wy-nav-top role=navigation aria-label="Mobile navigation menu"> <i data-toggle=wy-nav-top class="fa fa-bars"></i> <a href=../..>Opossum Search Documentation</a> </nav> <div class=wy-nav-content> <div class=rst-content><div role=navigation aria-label="breadcrumbs navigation"> <ul class=wy-breadcrumbs> <li><a href=../.. class="icon icon-home" aria-label=Docs></a></li> <li class=breadcrumb-item>Service Availability</li> <li class="breadcrumb-item active">Rate Limiting</li> <li class=wy-breadcrumbs-aside> </li> </ul> <hr> </div> <div role=main class=document itemscope=itemscope itemtype=http://schema.org/Article> <div class=section itemprop=articleBody> <h1 id=6-rate-limiting-and-throttling>6. Rate Limiting and Throttling</h1> <h2 id=61-rate-limit-policies>6.1 Rate Limit Policies</h2> <table> <thead> <tr> <th>Service</th> <th>Rate Limit Type</th> <th>Quota</th> <th>Reset Period</th> <th>Priority Handling</th> </tr> </thead> <tbody> <tr> <td>Gemini API</td> <td>API Calls</td> <td>60 per minute</td> <td>Minute</td> <td>High-value queries prioritized</td> </tr> <tr> <td>Gemini API</td> <td>Daily Usage</td> <td>60,000 per day</td> <td>24 hours</td> <td>Resource allocation based on time of day</td> </tr> <tr> <td>Ollama</td> <td>Local Resource</td> <td>CPU/GPU dependent</td> <td>N/A</td> <td>Queue-based with timeout</td> </tr> <tr> <td>Transformers</td> <td>Local Resource</td> <td>Memory/CPU dependent</td> <td>N/A</td> <td>Simplified models for high load</td> </tr> </tbody> </table> <h2 id=62-detection-mechanisms>6.2 Detection Mechanisms</h2> <table> <thead> <tr> <th>Limit Type</th> <th>Detection Method</th> <th>Response Code</th> <th>Handling Strategy</th> </tr> </thead> <tbody> <tr> <td>Pre-emptive</td> <td>Counter tracking</td> <td>N/A</td> <td>Redirect before limit reached</td> </tr> <tr> <td>Reactive</td> <td>HTTP 429 response</td> <td>429 Too Many Requests</td> <td>Immediate failover to alternative service</td> </tr> <tr> <td>Quota Exceeded</td> <td>HTTP 403 response</td> <td>403 Forbidden</td> <td>Temporary service downgrade</td> </tr> <tr> <td>Resource Exhaustion</td> <td>Exception/timeout</td> <td>Various</td> <td>Scale down model complexity</td> </tr> </tbody> </table> <h2 id=63-request-management>6.3 Request Management</h2> <table> <thead> <tr> <th>Approach</th> <th>Implementation</th> <th>Benefit</th> </tr> </thead> <tbody> <tr> <td>Request Queuing</td> <td>In-memory FIFO queue with priority</td> <td>Prevents request loss during high load</td> </tr> <tr> <td>Request Coalescing</td> <td>Combine similar requests</td> <td>Reduces total API calls</td> </tr> <tr> <td>Request Prioritization</td> <td>User interaction &gt; Background tasks</td> <td>Maintains responsive UX</td> </tr> <tr> <td>Adaptive TTL</td> <td>Dynamic cache lifetime based on load</td> <td>Reduces API calls during peak</td> </tr> </tbody> </table> <h2 id=64-throttling-implementation>6.4 Throttling Implementation</h2> <pre class=highlight><code class=language-python>class RateLimitManager:
    def __init__(self):
        self.minute_usage = 0
        self.daily_usage = 0
        self.last_minute_reset = datetime.now()
        self.last_daily_reset = datetime.now()
        self.request_queue = asyncio.Queue()

    async def track_request(self):
        """Track a new request against rate limits"""
        current_time = datetime.now()

        # Reset counters if needed
        if (current_time - self.last_minute_reset).seconds &gt;= 60:
            self.minute_usage = 0
            self.last_minute_reset = current_time

        if (current_time - self.last_daily_reset).days &gt;= 1:
            self.daily_usage = 0
            self.last_daily_reset = current_time

        # Increment counters
        self.minute_usage += 1
        self.daily_usage += 1

    async def can_process_request(self):
        """Check if request can be processed within rate limits"""
        return self.minute_usage &lt; 58  # Buffer of 2 requests

    async def process_or_queue(self, request_func, *args):
        """Process request or queue it based on rate limits"""
        if await self.can_process_request():
            await self.track_request()
            return await request_func(*args)
        else:
            # Queue the request or fail over
            return await self.handle_rate_limit(*args)</code></pre> <h2 id=65-client-side-adaptation>6.5 Client-Side Adaptation</h2> <table> <thead> <tr> <th>Condition</th> <th>Client Behavior</th> <th>User Experience</th> </tr> </thead> <tbody> <tr> <td>Server Rate Limited</td> <td>Switch to fallback simulation</td> <td>"Using simplified mode temporarily"</td> </tr> <tr> <td>Approaching Limits</td> <td>Batch requests</td> <td>Normal with slight delay</td> </tr> <tr> <td>Normal Operation</td> <td>Direct API access</td> <td>Full functionality</td> </tr> <tr> <td>Extended Outage</td> <td>Local-only operation</td> <td>Reduced capabilities with notification</td> </tr> </tbody> </table> <h2 id=66-balance-and-optimization-strategies>6.6 Balance and Optimization Strategies</h2> <table> <thead> <tr> <th>Strategy</th> <th>Implementation</th> <th>Effect</th> </tr> </thead> <tbody> <tr> <td>Time-of-day Allocation</td> <td>Reserve quota for peak hours</td> <td>Consistent availability during business hours</td> </tr> <tr> <td>Request Complexity Analysis</td> <td>Measure token count before sending</td> <td>Route complex queries to appropriate backend</td> </tr> <tr> <td>Adaptive Backoff</td> <td>Exponential delay with jitter</td> <td>Graceful recovery during service degradation</td> </tr> <tr> <td>Quota Forecasting</td> <td>Predictive usage modeling</td> <td>Proactive service switching before limits reached</td> </tr> </tbody> </table> <h2 id=67-monitoring-and-alerts>6.7 Monitoring and Alerts</h2> <table> <thead> <tr> <th>Metric</th> <th>Threshold</th> <th>Alert Type</th> <th>Recipient</th> </tr> </thead> <tbody> <tr> <td>Minute Usage</td> <td>&gt;80% of limit</td> <td>Warning</td> <td>Logs</td> </tr> <tr> <td>Minute Usage</td> <td>&gt;95% of limit</td> <td>Critical</td> <td>Operations Team</td> </tr> <tr> <td>Daily Usage</td> <td>&gt;90% of limit</td> <td>Warning</td> <td>Operations Team</td> </tr> <tr> <td>Queue Size</td> <td>&gt;20 requests</td> <td>Warning</td> <td>Logs</td> </tr> <tr> <td>Queue Size</td> <td>&gt;50 requests</td> <td>Critical</td> <td>Operations Team</td> </tr> <tr> <td>Queue Wait Time</td> <td>&gt;5 seconds</td> <td>Warning</td> <td>Logs, User Notification</td> </tr> </tbody> </table> </div> </div><footer> <div class=rst-footer-buttons role=navigation aria-label="Footer Navigation"> <a href=../service-outage/ class="btn btn-neutral float-left" title="Error Handling"><span class="icon icon-circle-arrow-left"></span> Previous</a> <a href=../log-alerts/ class="btn btn-neutral float-right" title="Logging and Alerts">Next <span class="icon icon-circle-arrow-right"></span></a> </div> <hr> <div role=contentinfo> <!-- Copyright etc --> </div> Built with <a href=https://www.mkdocs.org/ >MkDocs</a> using a <a href=https://github.com/readthedocs/sphinx_rtd_theme>theme</a> provided by <a href=https://readthedocs.org>Read the Docs</a>. </footer> </div> </div> </section> </div> <div class=rst-versions role=note aria-label=Versions> <span class=rst-current-version data-toggle=rst-current-version> <span><a href=../service-outage/ style="color: #fcfcfc">&laquo; Previous</a></span> <span><a href=../log-alerts/ style="color: #fcfcfc">Next &raquo;</a></span> </span> </div> <script src=../../js/jquery-3.6.0.min.js></script> <script>var base_url = "../..";</script> <script src=../../js/theme_extra.js></script> <script src=../../js/theme.js></script> <script src=../../search/main.js></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 