<!DOCTYPE html>
<html class="writer-html5" lang="en"> <head><meta charset="utf-8"/><meta content="IE=edge" http-equiv="X-UA-Compatible"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="bebo" name="author"/><link href="../../img/favicon.ico" rel="shortcut icon"/><title>DSPy Metrics &amp; Performance - Opossum Search Documentation</title><link href="../../css/theme.css" rel="stylesheet"/><link href="../../css/theme_extra.css" rel="stylesheet"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/><link href="../../assets/_mkdocstrings.css" rel="stylesheet"/><link href="../../stylesheets/extra.css" rel="stylesheet"/><script>
        // Current page data
        var mkdocs_page_name = "DSPy Metrics \u0026 Performance";
        var mkdocs_page_input_path = "model-integration/dspy-metrics.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script><script>hljs.highlightAll();</script></head> <body class="wy-body-for-nav" role="document"> <div class="wy-grid-for-nav"> <nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift"> <div class="wy-side-scroll"> <div class="wy-side-nav-search"> <a class="icon icon-home" href="../.."> Opossum Search Documentation </a><div role="search"> <form action="../../search.html" class="wy-form" id="rtd-search-form" method="get"> <input aria-label="Search docs" name="q" placeholder="Search docs" title="Type search term here" type="text"/> </form> </div> </div> <div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation"> <ul> <li class="toctree-l1"><a class="reference internal" href="../..">Home</a> </li> </ul> <p class="caption"><span class="caption-text">Getting Started</span></p> <ul> <li class="toctree-l1"><a class="reference internal" href="../../technical/getting-started/">First Steps</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../technical/system-architecture-overview/">System Overview</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../api/getting-started/">API Reference</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../technical/devops-guide/">Developer Quickstart</a> </li> </ul> <p class="caption"><span class="caption-text">Core Components</span></p> <ul class="current"> <li class="toctree-l1"><a class="reference internal">Architecture</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../technical/system-architecture-overview/">System Overview</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/mcp-architecture/">Model Context Protocol (MCP)</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/graphql-api/">GraphQL API</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/security-model/">Security Model</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/prompt-management/">Prompt Management</a> </li> </ul> </li> <li class="toctree-l1 current"><a class="reference internal current">Model Integration</a> <ul class="current"> <li class="toctree-l2"><a class="reference internal" href="../architecture/">Architecture</a> </li> <li class="toctree-l2"><a class="reference internal" href="../backend-selection/">Backend Selection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../capability-matrix/">Capability Matrix</a> </li> <li class="toctree-l2"><a class="reference internal" href="../providers/">Provider Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../configuration/">Configuration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/hybrid-model-selection/">Hybrid Selection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/prompt-management/">Prompt Management</a> </li> <li class="toctree-l2"><a class="reference internal" href="../dspy-integration/">DSPy Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../dspy-technical/">DSPy Technical Implementation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../dspy-examples/">DSPy Usage Examples</a> </li> <li class="toctree-l2 current"><a class="reference internal current" href="#">DSPy Metrics &amp; Performance</a> <ul class="current"> <li class="toctree-l3"><a class="reference internal" href="#measuring-dspy-performance">Measuring DSPy Performance</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#key-metrics">Key Metrics</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#monitoring-implementation">Monitoring Implementation</a> </li> <li class="toctree-l3"><a class="reference internal" href="#performance-visualization">Performance Visualization</a> </li> <li class="toctree-l3"><a class="reference internal" href="#quality-evaluation">Quality Evaluation</a> </li> <li class="toctree-l3"><a class="reference internal" href="#resource-optimization">Resource Optimization</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#memory-management">Memory Management</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#temporal-markers">Temporal Markers</a> </li> <li class="toctree-l3"><a class="reference internal" href="#related-documentation">Related Documentation</a> </li> </ul> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Service Availability</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/context-and-scope/">Context and Scope</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/quality-requirements/">Quality Requirements</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/architecture-constraints/">Architecture Constraints</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/availability-monitoring/">Availability Monitoring</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/service-outage/">Error Handling</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Resilience Patterns</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../technical/resilience-patterns/">Core Strategies</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/error-handling-resilience/">Error Handling</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/rate-limiting-throttling/">Rate Limiting</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/log-alerts/">Logging and Alerts</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/testing-validation/">Testing and Validation</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">Features</span></p> <ul> <li class="toctree-l1"><a class="reference internal">Conversation</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../conversation/topic-detection/">Topic Detection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/conversation-flow/">Conversation Flow</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/response-generation/">Response Generation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/nlp-components/">NLP Components</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/markov-generation/">Markov Generation</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Image Processing</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/overview/">Overview</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/effects/">Effects and Filters</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/svg-generation/">SVG Generation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/optimization/">Performance Optimization</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/caching/">Caching Strategy</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Visualizations &amp; Fun</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../features/service-vizualizations/">Service Visualizations</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/national-day/">National Opossum Day</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/opossum-xenzia/">Opossum Xenzia</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/easter-eggs/">Easter Eggs</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/special-events/">Special Events</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/background-stories/">Background Stories</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">Technical Reference</span></p> <ul> <li class="toctree-l1"><a class="reference internal">Infrastructure</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../technical/redis-caching-architecture/">Redis Caching</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/image-processing-pipeline/">Image Pipeline</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/opentelemetry-integration/">OpenTelemetry</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/svg-markup/">SVG Markup</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/bot-user-simulation/">Bot User Simulation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/optimization-strategies/">Optimization Strategies</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/pipeline-optimization/">Pipeline Optimization</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/constraint-mapping/">Constraint Mapping</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">API Documentation</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../api/routes/">Routes</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/request-response/">Request/Response</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/oauth-configuration/">OAuth Configuration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/error-codes/">Error Codes</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/rate-limits/">Rate Limits</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/webhooks/">Webhook Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/health-endpoints/">Health Endpoints</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/compliance/">Compliance</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">DSPy Tutorials</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/getting-started/">Getting Started with DSPy</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/optimizing-prompts/">Optimizing Prompts</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/building-pipelines/">Building Pipelines</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/advanced-reasoning/">Advanced Reasoning</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">About</span></p> <ul> <li class="toctree-l1"><a class="reference internal" href="../../about/history/">Project History</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/opossumial-way/">The Opossumial Way</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/team/">Team</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/roadmap-vision/">Roadmap &amp; Vision</a> </li> </ul> </div> </div> </nav> <section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"> <nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation"> <i class="fa fa-bars" data-toggle="wy-nav-top"></i> <a href="../..">Opossum Search Documentation</a> </nav> <div class="wy-nav-content"> <div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation"> <ul class="wy-breadcrumbs"> <li><a aria-label="Docs" class="icon icon-home" href="../.."></a></li> <li class="breadcrumb-item">Core Components</li> <li class="breadcrumb-item">Model Integration</li> <li class="breadcrumb-item active">DSPy Metrics &amp; Performance</li> <li class="wy-breadcrumbs-aside"> </li> </ul> <hr/> </div> <div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main"> <div class="section" itemprop="articleBody"> <h1 id="dspy-metrics-performance">DSPy Metrics &amp; Performance<a class="headerlink" href="#dspy-metrics-performance" title="Permanent link">¶</a></h1> <h2 id="measuring-dspy-performance">Measuring DSPy Performance<a class="headerlink" href="#measuring-dspy-performance" title="Permanent link">¶</a></h2> <p>Opossum Search implements comprehensive metrics and monitoring for DSPy integration to ensure optimal performance, quality, and resource utilization.</p> <h3 id="key-metrics">Key Metrics<a class="headerlink" href="#key-metrics" title="Permanent link">¶</a></h3> <table> <thead> <tr> <th>Metric</th> <th>Description</th> <th>Target</th> <th>Implementation</th> </tr> </thead> <tbody> <tr> <td>Prompt Optimization Score</td> <td>Effectiveness improvement of optimized prompts</td> <td>&gt;15% improvement</td> <td>A/B testing framework</td> </tr> <tr> <td>Optimization Time</td> <td>Time required to run DSPy optimizers</td> <td>&lt;60s per prompt</td> <td>Performance tracking</td> </tr> <tr> <td>Memory Consumption</td> <td>RAM usage during optimization</td> <td>&lt;2GB peak</td> <td>Resource monitoring</td> </tr> <tr> <td>Quality Improvement</td> <td>Enhanced response quality measured by evaluators</td> <td>&gt;20% improvement</td> <td>Automated evaluation</td> </tr> <tr> <td>Token Efficiency</td> <td>Token reduction while maintaining quality</td> <td>&gt;10% reduction</td> <td>Token counter</td> </tr> </tbody> </table> <h2 id="monitoring-implementation">Monitoring Implementation<a class="headerlink" href="#monitoring-implementation" title="Permanent link">¶</a></h2> <div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># app/integrations/dspy/metrics.py</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">statistics</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">prometheus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">Gauge</span><span class="p">,</span> <span class="n">Histogram</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c1"># Define Prometheus metrics</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="n">DSPY_OPTIMIZATION_TIME</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="s2">"opossum_dspy_optimization_time_seconds"</span><span class="p">,</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="s2">"Time taken for DSPy optimization in seconds"</span><span class="p">,</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="p">[</span><span class="s2">"prompt_type"</span><span class="p">,</span> <span class="s2">"optimizer"</span><span class="p">]</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="p">)</span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="n">DSPY_MEMORY_USAGE</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="s2">"opossum_dspy_memory_usage_mb"</span><span class="p">,</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="s2">"Memory used during DSPy optimization in MB"</span><span class="p">,</span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="p">[</span><span class="s2">"optimizer"</span><span class="p">]</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="p">)</span>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="n">DSPY_QUALITY_IMPROVEMENT</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
<a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="s2">"opossum_dspy_quality_improvement_percent"</span><span class="p">,</span>
<a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="s2">"Quality improvement percentage from DSPy optimization"</span><span class="p">,</span>
<a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="p">[</span><span class="s2">"prompt_type"</span><span class="p">]</span>
<a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="p">)</span>
<a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="n">DSPY_TOKEN_REDUCTION</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
<a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="s2">"opossum_dspy_token_reduction_percent"</span><span class="p">,</span>
<a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="s2">"Token reduction percentage from DSPy optimization"</span><span class="p">,</span>
<a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="p">[</span><span class="s2">"prompt_type"</span><span class="p">]</span>
<a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="p">)</span>
<a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="c1"># Helper class for tracking DSPy performance</span>
<a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">class</span><span class="w"> </span><span class="nc">DSPyPerformanceTracker</span><span class="p">:</span>
<a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt_type</span><span class="p">,</span> <span class="n">optimizer_name</span><span class="p">):</span>
<a href="#__codelineno-0-35" id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prompt_type</span> <span class="o">=</span> <span class="n">prompt_type</span>
<a href="#__codelineno-0-36" id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer_name</span> <span class="o">=</span> <span class="n">optimizer_name</span>
<a href="#__codelineno-0-37" id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
<a href="#__codelineno-0-38" id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_memory</span> <span class="o">=</span> <span class="kc">None</span>
<a href="#__codelineno-0-39" id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a href="#__codelineno-0-40" id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a href="#__codelineno-0-41" id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a href="#__codelineno-0-42" id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
<a href="#__codelineno-0-43" id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="k">return</span> <span class="bp">self</span>
<a href="#__codelineno-0-44" id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a href="#__codelineno-0-45" id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
<a href="#__codelineno-0-46" id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Only track successful completions</span>
<a href="#__codelineno-0-47" id="__codelineno-0-47" name="__codelineno-0-47"></a>            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
<a href="#__codelineno-0-48" id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="n">peak_memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
<a href="#__codelineno-0-49" id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="n">memory_used</span> <span class="o">=</span> <span class="n">peak_memory</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_memory</span>
<a href="#__codelineno-0-50" id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a href="#__codelineno-0-51" id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="c1"># Record metrics</span>
<a href="#__codelineno-0-52" id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">DSPY_OPTIMIZATION_TIME</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span>
<a href="#__codelineno-0-53" id="__codelineno-0-53" name="__codelineno-0-53"></a>                <span class="n">prompt_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prompt_type</span><span class="p">,</span>
<a href="#__codelineno-0-54" id="__codelineno-0-54" name="__codelineno-0-54"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer_name</span>
<a href="#__codelineno-0-55" id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="p">)</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
<a href="#__codelineno-0-56" id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a href="#__codelineno-0-57" id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="n">DSPY_MEMORY_USAGE</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span>
<a href="#__codelineno-0-58" id="__codelineno-0-58" name="__codelineno-0-58"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer_name</span>
<a href="#__codelineno-0-59" id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">memory_used</span><span class="p">)</span>
</code></pre></div> <h2 id="performance-visualization">Performance Visualization<a class="headerlink" href="#performance-visualization" title="Permanent link">¶</a></h2> <p>Opossum Search's service visualization system includes dedicated dashboards for DSPy performance monitoring:</p> <pre class="mermaid"><code>graph TB
    A[Raw Data Collection] --&gt; B[Metrics Aggregation]
    B --&gt; C[Time-Series DB]
    C --&gt; D[Visualization Layer]

    subgraph "DSPy Metrics"
        E[Optimization Performance]
        F[Quality Metrics]
        G[Resource Usage]
        H[Token Efficiency]
    end

    D --&gt; E
    D --&gt; F
    D --&gt; G
    D --&gt; H

    classDef primary fill:#f9f,stroke:#333,stroke-width:2px;
    classDef secondary fill:#bbf,stroke:#333,stroke-width:1px;

    class A,D primary;
    class B,C,E,F,G,H secondary;</code></pre> <h2 id="quality-evaluation">Quality Evaluation<a class="headerlink" href="#quality-evaluation" title="Permanent link">¶</a></h2> <p>To measure the quality improvements from DSPy, Opossum implements automatic evaluation:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># app/integrations/dspy/evaluation.py</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dspy</span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">ResponseQualityEvaluator</span><span class="p">:</span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="sd">"""Evaluate the quality of responses before and after DSPy optimization."""</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>            <span class="n">instruction</span><span class="o">=</span><span class="s2">"Evaluate the quality of the given response based on accuracy, helpfulness, and clarity."</span><span class="p">,</span>
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>            <span class="n">input_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"question"</span><span class="p">,</span> <span class="s2">"response"</span><span class="p">],</span>
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a>            <span class="n">output_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"score"</span><span class="p">,</span> <span class="s2">"reasoning"</span><span class="p">]</span>
<a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a>        <span class="p">)</span>
<a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a>
<a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">        </span><span class="sd">"""Evaluate a response on a 0-100 scale."""</span>
<a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="p">(</span>
<a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a>            <span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
<a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a>            <span class="n">response</span><span class="o">=</span><span class="n">response</span>
<a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a>        <span class="p">)</span>
<a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a>        <span class="k">return</span> <span class="p">{</span>
<a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a>            <span class="s2">"score"</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">score</span><span class="p">),</span>
<a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a>            <span class="s2">"reasoning"</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">reasoning</span>
<a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a>        <span class="p">}</span>
<a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a>
<a href="#__codelineno-1-25" id="__codelineno-1-25" name="__codelineno-1-25"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">baseline_response</span><span class="p">,</span> <span class="n">optimized_response</span><span class="p">):</span>
<a href="#__codelineno-1-26" id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">        </span><span class="sd">"""Compare baseline and optimized responses."""</span>
<a href="#__codelineno-1-27" id="__codelineno-1-27" name="__codelineno-1-27"></a>        <span class="n">baseline_eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">baseline_response</span><span class="p">)</span>
<a href="#__codelineno-1-28" id="__codelineno-1-28" name="__codelineno-1-28"></a>        <span class="n">optimized_eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">optimized_response</span><span class="p">)</span>
<a href="#__codelineno-1-29" id="__codelineno-1-29" name="__codelineno-1-29"></a>
<a href="#__codelineno-1-30" id="__codelineno-1-30" name="__codelineno-1-30"></a>        <span class="n">improvement</span> <span class="o">=</span> <span class="n">optimized_eval</span><span class="p">[</span><span class="s2">"score"</span><span class="p">]</span> <span class="o">-</span> <span class="n">baseline_eval</span><span class="p">[</span><span class="s2">"score"</span><span class="p">]</span>
<a href="#__codelineno-1-31" id="__codelineno-1-31" name="__codelineno-1-31"></a>        <span class="n">percent_improvement</span> <span class="o">=</span> <span class="p">(</span><span class="n">improvement</span> <span class="o">/</span> <span class="n">baseline_eval</span><span class="p">[</span><span class="s2">"score"</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">baseline_eval</span><span class="p">[</span><span class="s2">"score"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
<a href="#__codelineno-1-32" id="__codelineno-1-32" name="__codelineno-1-32"></a>
<a href="#__codelineno-1-33" id="__codelineno-1-33" name="__codelineno-1-33"></a>        <span class="n">DSPY_QUALITY_IMPROVEMENT</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span>
<a href="#__codelineno-1-34" id="__codelineno-1-34" name="__codelineno-1-34"></a>            <span class="n">prompt_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_detect_prompt_type</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
<a href="#__codelineno-1-35" id="__codelineno-1-35" name="__codelineno-1-35"></a>        <span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">percent_improvement</span><span class="p">)</span>
<a href="#__codelineno-1-36" id="__codelineno-1-36" name="__codelineno-1-36"></a>
<a href="#__codelineno-1-37" id="__codelineno-1-37" name="__codelineno-1-37"></a>        <span class="k">return</span> <span class="p">{</span>
<a href="#__codelineno-1-38" id="__codelineno-1-38" name="__codelineno-1-38"></a>            <span class="s2">"baseline_score"</span><span class="p">:</span> <span class="n">baseline_eval</span><span class="p">[</span><span class="s2">"score"</span><span class="p">],</span>
<a href="#__codelineno-1-39" id="__codelineno-1-39" name="__codelineno-1-39"></a>            <span class="s2">"optimized_score"</span><span class="p">:</span> <span class="n">optimized_eval</span><span class="p">[</span><span class="s2">"score"</span><span class="p">],</span>
<a href="#__codelineno-1-40" id="__codelineno-1-40" name="__codelineno-1-40"></a>            <span class="s2">"absolute_improvement"</span><span class="p">:</span> <span class="n">improvement</span><span class="p">,</span>
<a href="#__codelineno-1-41" id="__codelineno-1-41" name="__codelineno-1-41"></a>            <span class="s2">"percent_improvement"</span><span class="p">:</span> <span class="n">percent_improvement</span><span class="p">,</span>
<a href="#__codelineno-1-42" id="__codelineno-1-42" name="__codelineno-1-42"></a>            <span class="s2">"baseline_reasoning"</span><span class="p">:</span> <span class="n">baseline_eval</span><span class="p">[</span><span class="s2">"reasoning"</span><span class="p">],</span>
<a href="#__codelineno-1-43" id="__codelineno-1-43" name="__codelineno-1-43"></a>            <span class="s2">"optimized_reasoning"</span><span class="p">:</span> <span class="n">optimized_eval</span><span class="p">[</span><span class="s2">"reasoning"</span><span class="p">]</span>
<a href="#__codelineno-1-44" id="__codelineno-1-44" name="__codelineno-1-44"></a>        <span class="p">}</span>
</code></pre></div> <h2 id="resource-optimization">Resource Optimization<a class="headerlink" href="#resource-optimization" title="Permanent link">¶</a></h2> <p>DSPy integration is designed for efficient resource utilization:</p> <ol> <li><strong>Caching Strategy</strong>: All optimization results are cached to avoid redundant processing</li> <li><strong>Selective Application</strong>: DSPy optimization targets high-value prompts most likely to benefit</li> <li><strong>Scheduled Execution</strong>: Heavy optimization runs during off-peak hours</li> <li><strong>Progressive Implementation</strong>: Gradual rollout with careful monitoring of system impact</li> </ol> <h3 id="memory-management">Memory Management<a class="headerlink" href="#memory-management" title="Permanent link">¶</a></h3> <p>To prevent memory issues during optimization:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># app/integrations/dspy/memory.py</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">optimize_memory_usage</span><span class="p">():</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="sd">"""Optimize memory usage before/after DSPy operations."""</span>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>    <span class="c1"># Clear Python garbage collector</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a>    <span class="c1"># Clear CUDA cache if available</span>
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a>    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
<a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
<a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a>
<a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a>    <span class="c1"># Return current memory usage for monitoring</span>
<a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a>    <span class="k">return</span> <span class="p">{</span>
<a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a>        <span class="s2">"ram_percent"</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">percent</span><span class="p">,</span>
<a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a>        <span class="s2">"ram_used_gb"</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">used</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span>
<a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a>        <span class="s2">"process_mb"</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a>    <span class="p">}</span>
</code></pre></div> <p>◔ Section 1/4 Complete: Metrics Framework ◑ Section 2/4 Complete: Monitoring Implementation ◕ Section 3/4 Complete: Quality Evaluation ● Section 4/4 Complete: Resource Optimization</p> <h2 id="temporal-markers">Temporal Markers<a class="headerlink" href="#temporal-markers" title="Permanent link">¶</a></h2> <p>┌─────────────────────────────────────────────────────────┐ │ Last updated: 2025-04-11 │ │ Estimated reading time: 10 minutes │ │ Documentation heartbeat: 0 days since last validation │ └─────────────────────────────────────────────────────────┘</p> <h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">¶</a></h2> <ul> <li>DSPy Integration Overview</li> <li>DSPy Technical Implementation</li> <li>DSPy Usage Examples</li> <li>OpenTelemetry Integration</li> </ul> </div> </div><footer> <div aria-label="Footer Navigation" class="rst-footer-buttons" role="navigation"> <a class="btn btn-neutral float-left" href="../dspy-examples/" title="DSPy Usage Examples"><span class="icon icon-circle-arrow-left"></span> Previous</a> <a class="btn btn-neutral float-right" href="../../service-availability/context-and-scope/" title="Context and Scope">Next <span class="icon icon-circle-arrow-right"></span></a> </div> <hr/> <div role="contentinfo"> <!-- Copyright etc --> </div> Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. </footer> </div> </div> </section> </div> <div aria-label="Versions" class="rst-versions" role="note"> <span class="rst-current-version" data-toggle="rst-current-version"> <span><a href="../dspy-examples/" style="color: #fcfcfc">« Previous</a></span> <span><a href="../../service-availability/context-and-scope/" style="color: #fcfcfc">Next »</a></span> </span> </div> <script src="../../js/jquery-3.6.0.min.js"></script> <script>var base_url = "../..";</script> <script src="../../js/theme_extra.js"></script> <script src="../../js/theme.js"></script> <script src="../../search/main.js"></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 