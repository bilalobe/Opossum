<!DOCTYPE html>
<html class="writer-html5" lang="en"> <head><meta charset="utf-8"/><meta content="IE=edge" http-equiv="X-UA-Compatible"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="bebo" name="author"/><link href="../../img/favicon.ico" rel="shortcut icon"/><title>NLP Components - Opossum Search Documentation</title><link href="../../css/theme.css" rel="stylesheet"/><link href="../../css/theme_extra.css" rel="stylesheet"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/><link href="../../assets/_mkdocstrings.css" rel="stylesheet"/><link href="../../stylesheets/extra.css" rel="stylesheet"/><script>
        // Current page data
        var mkdocs_page_name = "NLP Components";
        var mkdocs_page_input_path = "conversation/nlp-components.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script><script>hljs.highlightAll();</script></head> <body class="wy-body-for-nav" role="document"> <div class="wy-grid-for-nav"> <nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift"> <div class="wy-side-scroll"> <div class="wy-side-nav-search"> <a class="icon icon-home" href="../.."> Opossum Search Documentation </a><div role="search"> <form action="../../search.html" class="wy-form" id="rtd-search-form" method="get"> <input aria-label="Search docs" name="q" placeholder="Search docs" title="Type search term here" type="text"/> </form> </div> </div> <div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation"> <ul> <li class="toctree-l1"><a class="reference internal" href="../..">Home</a> </li> </ul> <p class="caption"><span class="caption-text">Getting Started</span></p> <ul> <li class="toctree-l1"><a class="reference internal" href="../../technical/getting-started/">First Steps</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../technical/system-architecture-overview/">System Overview</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../api/getting-started/">API Reference</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../technical/devops-guide/">Developer Quickstart</a> </li> </ul> <p class="caption"><span class="caption-text">Core Components</span></p> <ul> <li class="toctree-l1"><a class="reference internal">Architecture</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../technical/system-architecture-overview/">System Overview</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/mcp-architecture/">Model Context Protocol (MCP)</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/graphql-api/">GraphQL API</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/security-model/">Security Model</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/prompt-management/">Prompt Management</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Model Integration</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/architecture/">Architecture</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/backend-selection/">Backend Selection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/capability-matrix/">Capability Matrix</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/providers/">Provider Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/configuration/">Configuration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/hybrid-model-selection/">Hybrid Selection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/prompt-management/">Prompt Management</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-integration/">DSPy Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-technical/">DSPy Technical Implementation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-examples/">DSPy Usage Examples</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-metrics/">DSPy Metrics &amp; Performance</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Service Availability</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/context-and-scope/">Context and Scope</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/quality-requirements/">Quality Requirements</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/architecture-constraints/">Architecture Constraints</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/availability-monitoring/">Availability Monitoring</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/service-outage/">Error Handling</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Resilience Patterns</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../technical/resilience-patterns/">Core Strategies</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/error-handling-resilience/">Error Handling</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/rate-limiting-throttling/">Rate Limiting</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/log-alerts/">Logging and Alerts</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/testing-validation/">Testing and Validation</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">Features</span></p> <ul class="current"> <li class="toctree-l1 current"><a class="reference internal current">Conversation</a> <ul class="current"> <li class="toctree-l2"><a class="reference internal" href="../topic-detection/">Topic Detection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../conversation-flow/">Conversation Flow</a> </li> <li class="toctree-l2"><a class="reference internal" href="../response-generation/">Response Generation</a> </li> <li class="toctree-l2 current"><a class="reference internal current" href="#">NLP Components</a> <ul class="current"> <li class="toctree-l3"><a class="reference internal" href="#sentence-transformers">Sentence Transformers</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#model-configuration">Model Configuration</a> </li> <li class="toctree-l4"><a class="reference internal" href="#usage-areas">Usage Areas</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#sentiment-analysis">Sentiment Analysis</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#metrics-tracked">Metrics Tracked</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#topic-classification">Topic Classification</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#topic-categories">Topic Categories</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#performance-optimization">Performance Optimization</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#caching-strategy">Caching Strategy</a> </li> <li class="toctree-l4"><a class="reference internal" href="#batch-processing">Batch Processing</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#integration-points">Integration Points</a> </li> <li class="toctree-l3"><a class="reference internal" href="#error-handling">Error Handling</a> </li> <li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a> </li> <li class="toctree-l3"><a class="reference internal" href="#engagement-detection">Engagement Detection</a> </li> <li class="toctree-l3"><a class="reference internal" href="#re-engagement-triggers">Re-engagement Triggers</a> </li> </ul> </li> <li class="toctree-l2"><a class="reference internal" href="../markov-generation/">Markov Generation</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Image Processing</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/overview/">Overview</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/effects/">Effects and Filters</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/svg-generation/">SVG Generation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/optimization/">Performance Optimization</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/caching/">Caching Strategy</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Visualizations &amp; Fun</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../features/service-vizualizations/">Service Visualizations</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/national-day/">National Opossum Day</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/opossum-xenzia/">Opossum Xenzia</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/easter-eggs/">Easter Eggs</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/special-events/">Special Events</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/background-stories/">Background Stories</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">Technical Reference</span></p> <ul> <li class="toctree-l1"><a class="reference internal">Infrastructure</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../technical/redis-caching-architecture/">Redis Caching</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/image-processing-pipeline/">Image Pipeline</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/opentelemetry-integration/">OpenTelemetry</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/svg-markup/">SVG Markup</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/bot-user-simulation/">Bot User Simulation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/optimization-strategies/">Optimization Strategies</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/pipeline-optimization/">Pipeline Optimization</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/constraint-mapping/">Constraint Mapping</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">API Documentation</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../api/routes/">Routes</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/request-response/">Request/Response</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/oauth-configuration/">OAuth Configuration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/error-codes/">Error Codes</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/rate-limits/">Rate Limits</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/webhooks/">Webhook Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/health-endpoints/">Health Endpoints</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/compliance/">Compliance</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">DSPy Tutorials</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/getting-started/">Getting Started with DSPy</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/optimizing-prompts/">Optimizing Prompts</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/building-pipelines/">Building Pipelines</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/advanced-reasoning/">Advanced Reasoning</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">About</span></p> <ul> <li class="toctree-l1"><a class="reference internal" href="../../about/history/">Project History</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/opossumial-way/">The Opossumial Way</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/team/">Team</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/roadmap-vision/">Roadmap &amp; Vision</a> </li> </ul> </div> </div> </nav> <section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"> <nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation"> <i class="fa fa-bars" data-toggle="wy-nav-top"></i> <a href="../..">Opossum Search Documentation</a> </nav> <div class="wy-nav-content"> <div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation"> <ul class="wy-breadcrumbs"> <li><a aria-label="Docs" class="icon icon-home" href="../.."></a></li> <li class="breadcrumb-item">Features</li> <li class="breadcrumb-item">Conversation</li> <li class="breadcrumb-item active">NLP Components</li> <li class="wy-breadcrumbs-aside"> </li> </ul> <hr/> </div> <div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main"> <div class="section" itemprop="articleBody"> <h1 id="nlp-components">NLP Components<a class="headerlink" href="#nlp-components" title="Permanent link">¶</a></h1> <p>The Opossum system uses several Natural Language Processing (NLP) components for different aspects of conversation handling.</p> <h2 id="sentence-transformers">Sentence Transformers<a class="headerlink" href="#sentence-transformers" title="Permanent link">¶</a></h2> <h3 id="model-configuration">Model Configuration<a class="headerlink" href="#model-configuration" title="Permanent link">¶</a></h3> <ul> <li>Model: <code>all-MiniLM-L6-v2</code></li> <li>Purpose: Semantic similarity and topic detection</li> <li>Implementation: Sentence-transformers library</li> </ul> <h3 id="usage-areas">Usage Areas<a class="headerlink" href="#usage-areas" title="Permanent link">¶</a></h3> <ol> <li> <p>Topic Detection</p> <ul> <li>Embedding generation for topic sentences</li> <li>Similarity scoring for topic matching</li> <li>Follow-up question detection</li> </ul> </li> <li> <p>Message Understanding</p> <ul> <li>User intent classification</li> <li>Context preservation</li> <li>Semantic similarity calculations</li> </ul> </li> </ol> <h2 id="sentiment-analysis">Sentiment Analysis<a class="headerlink" href="#sentiment-analysis" title="Permanent link">¶</a></h2> <p>The system uses TextBlob for sentiment analysis:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyze_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_follow_up</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">    </span><span class="sd">"""Analyze message sentiment and update metrics."""</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="n">blob</span> <span class="o">=</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="n">sentiment_scores</span> <span class="o">=</span> <span class="p">{</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="s2">"polarity"</span><span class="p">:</span> <span class="n">blob</span><span class="o">.</span><span class="n">sentiment</span><span class="o">.</span><span class="n">polarity</span><span class="p">,</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="s2">"subjectivity"</span><span class="p">:</span> <span class="n">blob</span><span class="o">.</span><span class="n">sentiment</span><span class="o">.</span><span class="n">subjectivity</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="p">}</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="c1"># Update sentiment history</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sentiment_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentiment_scores</span><span class="p">[</span><span class="s2">"polarity"</span><span class="p">])</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="c1"># Calculate sentiment trend</span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sentiment_history</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a>        <span class="n">trend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a>            <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sentiment_history</span><span class="p">)),</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a>            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sentiment_history</span><span class="p">),</span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a>            <span class="mi">1</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a>        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engagement_metrics</span><span class="p">[</span><span class="s2">"sentiment_trend"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">trend</span><span class="p">)</span>
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="c1"># Update engagement metrics...</span>
<a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="k">return</span> <span class="p">{</span>
<a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="s2">"sentiment"</span><span class="p">:</span> <span class="n">sentiment_scores</span><span class="p">,</span>
<a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="s2">"engagement"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">engagement_metrics</span>
<a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="p">}</span>
</code></pre></div> <h3 id="metrics-tracked">Metrics Tracked<a class="headerlink" href="#metrics-tracked" title="Permanent link">¶</a></h3> <ul> <li>Message polarity (-1 to 1)</li> <li>Subjectivity (0 to 1)</li> <li>Engagement trends</li> <li>Response patterns</li> </ul> <h2 id="topic-classification">Topic Classification<a class="headerlink" href="#topic-classification" title="Permanent link">¶</a></h2> <p>Topic detection uses a combination of:</p> <ol> <li> <p>Semantic Embeddings</p> <ul> <li>Pre-computed topic embeddings</li> <li>Real-time message embedding</li> <li>Cosine similarity matching</li> </ul> </li> <li> <p>Rule-based Detection</p> <ul> <li>Follow-up indicators</li> <li>Greeting patterns</li> <li>Closing phrases</li> </ul> </li> </ol> <h3 id="topic-categories">Topic Categories<a class="headerlink" href="#topic-categories" title="Permanent link">¶</a></h3> <div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">topic_sentences</span> <span class="o">=</span> <span class="p">{</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="s2">"snake_resistance"</span><span class="p">:</span> <span class="s2">"Opossums are resistant to snake venom..."</span><span class="p">,</span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span class="s2">"florida_opossums"</span><span class="p">:</span> <span class="s2">"Opossums in Florida..."</span><span class="p">,</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>    <span class="s2">"diet_query"</span><span class="p">:</span> <span class="s2">"What opossums eat..."</span><span class="p">,</span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>    <span class="s2">"habitat_query"</span><span class="p">:</span> <span class="s2">"Where opossums live..."</span><span class="p">,</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>    <span class="s2">"behavior_query"</span><span class="p">:</span> <span class="s2">"Opossum behavior..."</span><span class="p">,</span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="p">}</span>
</code></pre></div> <h2 id="performance-optimization">Performance Optimization<a class="headerlink" href="#performance-optimization" title="Permanent link">¶</a></h2> <h3 id="caching-strategy">Caching Strategy<a class="headerlink" href="#caching-strategy" title="Permanent link">¶</a></h3> <ul> <li>Topic embeddings pre-computed</li> <li>Sentiment scores cached</li> <li>Recent analyses retained</li> </ul> <h3 id="batch-processing">Batch Processing<a class="headerlink" href="#batch-processing" title="Permanent link">¶</a></h3> <ul> <li>Message history analysis</li> <li>Trend calculation</li> <li>Engagement scoring</li> </ul> <h2 id="integration-points">Integration Points<a class="headerlink" href="#integration-points" title="Permanent link">¶</a></h2> <pre class="mermaid"><code>graph TD
    A[Raw Message] --&gt; B[Sentence Transformer]
    A --&gt; C[Sentiment Analysis]
    B --&gt; D[Topic Detection]
    C --&gt; E[Engagement Tracking]
    D --&gt; F[Response Generation]
    E --&gt; F</code></pre> <h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">¶</a></h2> <ol> <li>Model Loading</li> </ol> <div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">try</span><span class="p">:</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">SentenceTransformer</span><span class="p">(</span><span class="n">Config</span><span class="o">.</span><span class="n">SENTENCE_TRANSFORMER_MODEL</span><span class="p">)</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"Required NLP packages not available"</span><span class="p">)</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>    <span class="k">raise</span>
</code></pre></div> <ol> <li>Embedding Generation</li> </ol> <div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">try</span><span class="p">:</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span class="n">message_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">user_message</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Embedding generation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span class="k">return</span> <span class="s2">"general_info"</span>  <span class="c1"># Fallback topic</span>
</code></pre></div> <h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">¶</a></h2> <p>Key NLP settings from Config:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">SENTENCE_TRANSFORMER_MODEL</span> <span class="o">=</span> <span class="s1">'all-MiniLM-L6-v2'</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">SIMILARITY_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.35</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="n">CACHE_TTL</span> <span class="o">=</span> <span class="mi">600</span>  <span class="c1"># 10 minutes</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="n">MAX_CONTEXT_WINDOW</span> <span class="o">=</span> <span class="mi">5</span>
</code></pre></div> <h2 id="engagement-detection">Engagement Detection<a class="headerlink" href="#engagement-detection" title="Permanent link">¶</a></h2> <p>The system identifies several engagement signals:</p> <ul> <li>Sentiment trend (declining vs. improving)</li> <li>Message length over time</li> <li>Follow-up question frequency</li> <li>Overall conversation mood</li> </ul> <h2 id="re-engagement-triggers">Re-engagement Triggers<a class="headerlink" href="#re-engagement-triggers" title="Permanent link">¶</a></h2> <div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_needs_reengagement</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="sd">"""Determine if conversation needs reengagement strategies."""</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentiment_history</span><span class="p">:</span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>        <span class="k">return</span> <span class="kc">False</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>    <span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engagement_metrics</span><span class="p">[</span><span class="s2">"sentiment_trend"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">engagement_metrics</span><span class="p">[</span><span class="s2">"avg_response_length"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">,</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sentiment_history</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> 
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>        <span class="nb">all</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sentiment_history</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>    <span class="p">]</span>
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
</code></pre></div> </div> </div><footer> <div aria-label="Footer Navigation" class="rst-footer-buttons" role="navigation"> <a class="btn btn-neutral float-left" href="../response-generation/" title="Response Generation"><span class="icon icon-circle-arrow-left"></span> Previous</a> <a class="btn btn-neutral float-right" href="../markov-generation/" title="Markov Generation">Next <span class="icon icon-circle-arrow-right"></span></a> </div> <hr/> <div role="contentinfo"> <!-- Copyright etc --> </div> Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. </footer> </div> </div> </section> </div> <div aria-label="Versions" class="rst-versions" role="note"> <span class="rst-current-version" data-toggle="rst-current-version"> <span><a href="../response-generation/" style="color: #fcfcfc">« Previous</a></span> <span><a href="../markov-generation/" style="color: #fcfcfc">Next »</a></span> </span> </div> <script src="../../js/jquery-3.6.0.min.js"></script> <script>var base_url = "../..";</script> <script src="../../js/theme_extra.js"></script> <script src="../../js/theme.js"></script> <script src="../../search/main.js"></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 