<!DOCTYPE html>
<html class="writer-html5" lang="en"> <head><meta charset="utf-8"/><meta content="IE=edge" http-equiv="X-UA-Compatible"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="bebo" name="author"/><link href="../../img/favicon.ico" rel="shortcut icon"/><title>Prompt Management - Opossum Search Documentation</title><link href="../../css/theme.css" rel="stylesheet"/><link href="../../css/theme_extra.css" rel="stylesheet"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/><link href="../../assets/_mkdocstrings.css" rel="stylesheet"/><link href="../../stylesheets/extra.css" rel="stylesheet"/><script>
        // Current page data
        var mkdocs_page_name = "Prompt Management";
        var mkdocs_page_input_path = "technical\\prompt-management.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script><script>hljs.highlightAll();</script></head> <body class="wy-body-for-nav" role="document"> <div class="wy-grid-for-nav"> <nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift"> <div class="wy-side-scroll"> <div class="wy-side-nav-search"> <a class="icon icon-home" href="../.."> Opossum Search Documentation </a><div role="search"> <form action="../../search.html" class="wy-form" id="rtd-search-form" method="get"> <input aria-label="Search docs" name="q" placeholder="Search docs" title="Type search term here" type="text"/> </form> </div> </div> <div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation"> <ul> <li class="toctree-l1"><a class="reference internal" href="../..">Home</a> </li> </ul> <p class="caption"><span class="caption-text">Getting Started</span></p> <ul> <li class="toctree-l1"><a class="reference internal" href="../getting-started/">First Steps</a> </li> <li class="toctree-l1"><a class="reference internal" href="../system-architecture-overview/">System Overview</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../api/getting-started/">API Reference</a> </li> <li class="toctree-l1"><a class="reference internal" href="../devops-guide/">Developer Quickstart</a> </li> </ul> <p class="caption"><span class="caption-text">Core Components</span></p> <ul class="current"> <li class="toctree-l1"><a class="reference internal">Architecture</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../system-architecture-overview/">System Overview</a> </li> <li class="toctree-l2"><a class="reference internal" href="../graphql-api/">GraphQL API</a> </li> <li class="toctree-l2"><a class="reference internal" href="../security-model/">Security Model</a> </li> <li class="toctree-l2 current"><a class="reference internal current" href="#">Prompt Management</a> <ul class="current"> <li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a> </li> <li class="toctree-l3"><a class="reference internal" href="#key-concepts">Key Concepts</a> </li> <li class="toctree-l3"><a class="reference internal" href="#integration-with-existing-prompt-system">Integration with Existing Prompt System</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#architecture-overview">Architecture Overview</a> </li> <li class="toctree-l4"><a class="reference internal" href="#integration-components">Integration Components</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#transforming-yaml-templates-to-dspy">Transforming YAML Templates to DSPy</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#current-yaml-structure">Current YAML Structure</a> </li> <li class="toctree-l4"><a class="reference internal" href="#dspy-transformation">DSPy Transformation</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#optimization-workflow">Optimization Workflow</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#step-1-define-optimization-targets">Step 1: Define Optimization Targets</a> </li> <li class="toctree-l4"><a class="reference internal" href="#step-2-evaluation-metrics">Step 2: Evaluation Metrics</a> </li> <li class="toctree-l4"><a class="reference internal" href="#step-3-versioning-and-storage">Step 3: Versioning and Storage</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#runtime-integration">Runtime Integration</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#using-optimized-prompts">Using Optimized Prompts</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#development-workflow">Development Workflow</a> </li> <li class="toctree-l3"><a class="reference internal" href="#benefits-over-traditional-approach">Benefits Over Traditional Approach</a> </li> <li class="toctree-l3"><a class="reference internal" href="#best-practices">Best Practices</a> </li> <li class="toctree-l3"><a class="reference internal" href="#related-documentation">Related Documentation</a> </li> </ul> </li> </ul> </li> <li class="toctree-l1 current"><a class="reference internal current">Model Integration</a> <ul class="current"> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/architecture/">Architecture</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/backend-selection/">Backend Selection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/capability-matrix/">Capability Matrix</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/providers/">Provider Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/configuration/">Configuration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../hybrid-model-selection/">Hybrid Selection</a> </li> <li class="toctree-l2 current"><a class="reference internal current" href="#">Prompt Management</a> <ul class="current"> <li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a> </li> <li class="toctree-l3"><a class="reference internal" href="#key-concepts">Key Concepts</a> </li> <li class="toctree-l3"><a class="reference internal" href="#integration-with-existing-prompt-system">Integration with Existing Prompt System</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#architecture-overview">Architecture Overview</a> </li> <li class="toctree-l4"><a class="reference internal" href="#integration-components">Integration Components</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#transforming-yaml-templates-to-dspy">Transforming YAML Templates to DSPy</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#current-yaml-structure">Current YAML Structure</a> </li> <li class="toctree-l4"><a class="reference internal" href="#dspy-transformation">DSPy Transformation</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#optimization-workflow">Optimization Workflow</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#step-1-define-optimization-targets">Step 1: Define Optimization Targets</a> </li> <li class="toctree-l4"><a class="reference internal" href="#step-2-evaluation-metrics">Step 2: Evaluation Metrics</a> </li> <li class="toctree-l4"><a class="reference internal" href="#step-3-versioning-and-storage">Step 3: Versioning and Storage</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#runtime-integration">Runtime Integration</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#using-optimized-prompts">Using Optimized Prompts</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#development-workflow">Development Workflow</a> </li> <li class="toctree-l3"><a class="reference internal" href="#benefits-over-traditional-approach">Benefits Over Traditional Approach</a> </li> <li class="toctree-l3"><a class="reference internal" href="#best-practices">Best Practices</a> </li> <li class="toctree-l3"><a class="reference internal" href="#related-documentation">Related Documentation</a> </li> </ul> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-integration/">DSPy Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-technical/">DSPy Technical Implementation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-examples/">DSPy Usage Examples</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-metrics/">DSPy Metrics &amp; Performance</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Service Availability</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/context-and-scope/">Context and Scope</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/quality-requirements/">Quality Requirements</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/architecture-constraints/">Architecture Constraints</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/availability-monitoring/">Availability Monitoring</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/service-outage/">Error Handling</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Resilience Patterns</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../resilience-patterns/">Core Strategies</a> </li> <li class="toctree-l2"><a class="reference internal" href="../error-handling-resilience/">Error Handling</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/rate-limiting-throttling/">Rate Limiting</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/log-alerts/">Logging and Alerts</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/testing-validation/">Testing and Validation</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">Features</span></p> <ul> <li class="toctree-l1"><a class="reference internal">Conversation</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../conversation/topic-detection/">Topic Detection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/conversation-flow/">Conversation Flow</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/response-generation/">Response Generation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/nlp-components/">NLP Components</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/markov-generation/">Markov Generation</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Image Processing</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/overview/">Overview</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/effects/">Effects and Filters</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/svg-generation/">SVG Generation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/optimization/">Performance Optimization</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/caching/">Caching Strategy</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Visualizations &amp; Fun</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../features/service-vizualizations/">Service Visualizations</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/national-day/">National Opossum Day</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/easter-eggs/">Easter Eggs</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/special-events/">Special Events</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/background-stories/">Background Stories</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">Technical Reference</span></p> <ul> <li class="toctree-l1"><a class="reference internal">Infrastructure</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../redis-caching-architecture/">Redis Caching</a> </li> <li class="toctree-l2"><a class="reference internal" href="../image-processing-pipeline/">Image Pipeline</a> </li> <li class="toctree-l2"><a class="reference internal" href="../opentelemetry-integration/">OpenTelemetry</a> </li> <li class="toctree-l2"><a class="reference internal" href="../svg-markup/">SVG Markup</a> </li> <li class="toctree-l2"><a class="reference internal" href="../bot-user-simulation/">Bot User Simulation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/optimization-strategies/">Optimization Strategies</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/pipeline-optimization/">Pipeline Optimization</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/constraint-mapping/">Constraint Mapping</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">API Documentation</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../api/routes/">Routes</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/request-response/">Request/Response</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/oauth-configuration/">OAuth Configuration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/error-codes/">Error Codes</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/rate-limits/">Rate Limits</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/webhooks/">Webhook Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/health-endpoints/">Health Endpoints</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/compliance/">Compliance</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">DSPy Tutorials</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/getting-started/">Getting Started with DSPy</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/optimizing-prompts/">Optimizing Prompts</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/building-pipelines/">Building Pipelines</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/advanced-reasoning/">Advanced Reasoning</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">About</span></p> <ul> <li class="toctree-l1"><a class="reference internal" href="../../about/history/">Project History</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/team/">Team</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/roadmap/">Roadmap</a> </li> </ul> </div> </div> </nav> <section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"> <nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation"> <i class="fa fa-bars" data-toggle="wy-nav-top"></i> <a href="../..">Opossum Search Documentation</a> </nav> <div class="wy-nav-content"> <div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation"> <ul class="wy-breadcrumbs"> <li><a aria-label="Docs" class="icon icon-home" href="../.."></a></li> <li class="breadcrumb-item">Core Components</li> <li class="breadcrumb-item">Model Integration</li> <li class="breadcrumb-item active">Prompt Management</li> <li class="wy-breadcrumbs-aside"> </li> </ul> <hr/> </div> <div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main"> <div class="section" itemprop="articleBody"> <h1 id="dspy-prompt-management">DSPy Prompt Management<a class="headerlink" href="#dspy-prompt-management" title="Permanent link">¶</a></h1> <h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2> <p>This document explains how DSPy integrates with Opossum's existing prompt management system to provide systematic prompt optimization, evaluation, and versioning capabilities.</p> <h2 id="key-concepts">Key Concepts<a class="headerlink" href="#key-concepts" title="Permanent link">¶</a></h2> <p>DSPy transforms traditional prompt engineering from a manual art into a systematic engineering discipline through:</p> <ol> <li><strong>Programmatic Definition</strong>: Prompts as code rather than strings</li> <li><strong>Optimization Pipelines</strong>: Automated refinement of prompts</li> <li><strong>Compositional Structure</strong>: Building complex prompts from simpler components</li> <li><strong>Metric-Driven Evaluation</strong>: Measuring prompt effectiveness objectively</li> </ol> <h2 id="integration-with-existing-prompt-system">Integration with Existing Prompt System<a class="headerlink" href="#integration-with-existing-prompt-system" title="Permanent link">¶</a></h2> <h3 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link">¶</a></h3> <pre class="mermaid"><code>graph TB
    A[YAML Prompt Templates] --&gt; B[Template Loader]
    B --&gt; C{Integration Layer}

    D[DSPy Signatures] --&gt; C
    E[DSPy Modules] --&gt; C

    C --&gt; F[Runtime Prompt Selection]
    C --&gt; G[Dev-time Optimization]

    G --&gt; H[Optimized Templates]
    H --&gt; I[Template Store]
    I --&gt; F

    F --&gt; J[LLM Providers]

    classDef primary fill:#f9f,stroke:#333,stroke-width:2px;
    classDef secondary fill:#bbf,stroke:#333,stroke-width:1px;
    class A,D,J primary;
    class B,C,E,F,G,H,I secondary;</code></pre> <h3 id="integration-components">Integration Components<a class="headerlink" href="#integration-components" title="Permanent link">¶</a></h3> <ol> <li><strong>Prompt Adapter</strong>: Bridges YAML templates and DSPy Signatures</li> <li><strong>Optimization Manager</strong>: Schedules and executes optimization runs</li> <li><strong>Version Control</strong>: Tracks prompt evolution and performance</li> <li><strong>Template Store</strong>: Manages optimized prompt variants</li> </ol> <h2 id="transforming-yaml-templates-to-dspy">Transforming YAML Templates to DSPy<a class="headerlink" href="#transforming-yaml-templates-to-dspy" title="Permanent link">¶</a></h2> <h3 id="current-yaml-structure">Current YAML Structure<a class="headerlink" href="#current-yaml-structure" title="Permanent link">¶</a></h3> <div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nt">conversation</span><span class="p">:</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="no">You are Opossum Search, a helpful assistant.</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="no">Respond in a friendly, conversational manner.</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="no">If you don't know something, admit it.</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">  </span><span class="nt">user_template</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="no">User query: {{query}}</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="no">Additional context: {{context}}</span>
</code></pre></div> <h3 id="dspy-transformation">DSPy Transformation<a class="headerlink" href="#dspy-transformation" title="Permanent link">¶</a></h3> <div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># Converting YAML templates to DSPy signatures</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">app.prompts.loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_prompt_template</span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dspy</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">ConversationSignature</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Signature</span><span class="p">):</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="sd">"""Signature for conversational responses."""</span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">InputField</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">"User's query"</span><span class="p">)</span>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>    <span class="n">context</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">InputField</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">"Additional context for the query"</span><span class="p">)</span>
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">OutputField</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">"Assistant's helpful response"</span><span class="p">)</span>
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_signature_from_yaml</span><span class="p">(</span><span class="n">template_name</span><span class="p">):</span>
<a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">    </span><span class="sd">"""Create a DSPy signature from a YAML template."""</span>
<a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a>    <span class="n">template</span> <span class="o">=</span> <span class="n">get_prompt_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
<a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a>
<a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a>    <span class="c1"># Extract input fields from template</span>
<a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a>    <span class="n">input_fields</span> <span class="o">=</span> <span class="n">extract_fields_from_template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
<a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a>
<a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a>    <span class="c1"># Create a dynamic signature class</span>
<a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a>    <span class="n">SignatureClass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span>
<a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a>        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">template_name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="si">}</span><span class="s2">Signature"</span><span class="p">,</span>
<a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a>        <span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Signature</span><span class="p">,),</span>
<a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a>        <span class="p">{</span>
<a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a>            <span class="n">field</span><span class="p">:</span> <span class="n">dspy</span><span class="o">.</span><span class="n">InputField</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">input_fields</span>
<a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a>        <span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="s2">"response"</span><span class="p">:</span> <span class="n">dspy</span><span class="o">.</span><span class="n">OutputField</span><span class="p">()}</span>
<a href="#__codelineno-1-25" id="__codelineno-1-25" name="__codelineno-1-25"></a>    <span class="p">)</span>
<a href="#__codelineno-1-26" id="__codelineno-1-26" name="__codelineno-1-26"></a>
<a href="#__codelineno-1-27" id="__codelineno-1-27" name="__codelineno-1-27"></a>    <span class="k">return</span> <span class="n">SignatureClass</span>
</code></pre></div> <h2 id="optimization-workflow">Optimization Workflow<a class="headerlink" href="#optimization-workflow" title="Permanent link">¶</a></h2> <h3 id="step-1-define-optimization-targets">Step 1: Define Optimization Targets<a class="headerlink" href="#step-1-define-optimization-targets" title="Permanent link">¶</a></h3> <div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># app/integrations/dspy/optimization.py</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">dspy</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">app.data.examples</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_examples</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">optimize_prompt_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">num_examples</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="sd">"""Optimize a prompt template using DSPy."""</span>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>    <span class="c1"># Load examples for this template</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>    <span class="n">examples</span> <span class="o">=</span> <span class="n">load_examples</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">num_examples</span><span class="p">)</span>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a>    <span class="c1"># Create baseline module</span>
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a>    <span class="n">signature</span> <span class="o">=</span> <span class="n">create_signature_from_yaml</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
<a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a>    <span class="n">baseline</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span><span class="n">signature</span><span class="p">)</span>
<a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a>
<a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a>    <span class="c1"># Define optimization metric</span>
<a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a>    <span class="n">metric</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Metric</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"response_quality"</span><span class="p">,</span> 
<a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a>                         <span class="n">fn</span><span class="o">=</span><span class="n">evaluate_response_quality</span><span class="p">)</span>
<a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a>
<a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a>    <span class="c1"># Create and configure teleprompter</span>
<a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a>    <span class="n">teleprompter</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Teleprompter</span><span class="p">(</span>
<a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a>        <span class="n">baseline</span><span class="p">,</span> 
<a href="#__codelineno-2-21" id="__codelineno-2-21" name="__codelineno-2-21"></a>        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
<a href="#__codelineno-2-22" id="__codelineno-2-22" name="__codelineno-2-22"></a>        <span class="n">max_rounds</span><span class="o">=</span><span class="mi">5</span>
<a href="#__codelineno-2-23" id="__codelineno-2-23" name="__codelineno-2-23"></a>    <span class="p">)</span>
<a href="#__codelineno-2-24" id="__codelineno-2-24" name="__codelineno-2-24"></a>
<a href="#__codelineno-2-25" id="__codelineno-2-25" name="__codelineno-2-25"></a>    <span class="c1"># Run optimization</span>
<a href="#__codelineno-2-26" id="__codelineno-2-26" name="__codelineno-2-26"></a>    <span class="n">optimized</span> <span class="o">=</span> <span class="n">teleprompter</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
<a href="#__codelineno-2-27" id="__codelineno-2-27" name="__codelineno-2-27"></a>
<a href="#__codelineno-2-28" id="__codelineno-2-28" name="__codelineno-2-28"></a>    <span class="c1"># Persist optimized template</span>
<a href="#__codelineno-2-29" id="__codelineno-2-29" name="__codelineno-2-29"></a>    <span class="n">save_optimized_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">optimized</span><span class="p">)</span>
<a href="#__codelineno-2-30" id="__codelineno-2-30" name="__codelineno-2-30"></a>
<a href="#__codelineno-2-31" id="__codelineno-2-31" name="__codelineno-2-31"></a>    <span class="k">return</span> <span class="n">optimized</span>
</code></pre></div> <h3 id="step-2-evaluation-metrics">Step 2: Evaluation Metrics<a class="headerlink" href="#step-2-evaluation-metrics" title="Permanent link">¶</a></h3> <p>DSPy allows for sophisticated evaluation of prompt quality:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># Evaluating prompt effectiveness</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">evaluate_response_quality</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">prediction</span><span class="p">):</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="sd">"""Evaluate the quality of a model response."""</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="c1"># Option 1: LLM-based evaluation</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>        <span class="n">instruction</span><span class="o">=</span><span class="s2">"Evaluate the quality of this response on a scale of 1-10."</span><span class="p">,</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>        <span class="n">input_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"query"</span><span class="p">,</span> <span class="s2">"true_response"</span><span class="p">,</span> <span class="s2">"predicted_response"</span><span class="p">],</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>        <span class="n">output_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"score"</span><span class="p">,</span> <span class="s2">"reasoning"</span><span class="p">]</span>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>    <span class="p">)</span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="n">eval_result</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>        <span class="n">query</span><span class="o">=</span><span class="n">example</span><span class="o">.</span><span class="n">query</span><span class="p">,</span>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>        <span class="n">true_response</span><span class="o">=</span><span class="n">example</span><span class="o">.</span><span class="n">response</span><span class="p">,</span>
<a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a>        <span class="n">predicted_response</span><span class="o">=</span><span class="n">prediction</span><span class="o">.</span><span class="n">response</span>
<a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a>    <span class="p">)</span>
<a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a>
<a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a>    <span class="c1"># Option 2: Programmatic metrics</span>
<a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a>    <span class="n">relevance_score</span> <span class="o">=</span> <span class="n">measure_relevance</span><span class="p">(</span><span class="n">example</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">prediction</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
<a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a>    <span class="n">coherence_score</span> <span class="o">=</span> <span class="n">measure_coherence</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
<a href="#__codelineno-3-20" id="__codelineno-3-20" name="__codelineno-3-20"></a>    <span class="n">factuality_score</span> <span class="o">=</span> <span class="n">measure_factuality</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">response</span><span class="p">)</span>
<a href="#__codelineno-3-21" id="__codelineno-3-21" name="__codelineno-3-21"></a>
<a href="#__codelineno-3-22" id="__codelineno-3-22" name="__codelineno-3-22"></a>    <span class="c1"># Combined score</span>
<a href="#__codelineno-3-23" id="__codelineno-3-23" name="__codelineno-3-23"></a>    <span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">eval_result</span><span class="o">.</span><span class="n">score</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.7</span> <span class="o">+</span> 
<a href="#__codelineno-3-24" id="__codelineno-3-24" name="__codelineno-3-24"></a>             <span class="n">relevance_score</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> 
<a href="#__codelineno-3-25" id="__codelineno-3-25" name="__codelineno-3-25"></a>             <span class="n">coherence_score</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> 
<a href="#__codelineno-3-26" id="__codelineno-3-26" name="__codelineno-3-26"></a>             <span class="n">factuality_score</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
<a href="#__codelineno-3-27" id="__codelineno-3-27" name="__codelineno-3-27"></a>
<a href="#__codelineno-3-28" id="__codelineno-3-28" name="__codelineno-3-28"></a>    <span class="k">return</span> <span class="n">score</span>
</code></pre></div> <h3 id="step-3-versioning-and-storage">Step 3: Versioning and Storage<a class="headerlink" href="#step-3-versioning-and-storage" title="Permanent link">¶</a></h3> <div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># Managing prompt versions</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_optimized_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">optimized_module</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="sd">"""Save an optimized template version."""</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>    <span class="c1"># Extract prompt from module</span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a>    <span class="n">optimized_prompt</span> <span class="o">=</span> <span class="n">extract_prompt_from_module</span><span class="p">(</span><span class="n">optimized_module</span><span class="p">)</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>    <span class="c1"># Generate version info</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>    <span class="n">version_info</span> <span class="o">=</span> <span class="p">{</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>        <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>        <span class="s2">"base_template"</span><span class="p">:</span> <span class="n">template_name</span><span class="p">,</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a>        <span class="s2">"performance_metrics"</span><span class="p">:</span> <span class="n">get_performance_metrics</span><span class="p">(</span><span class="n">optimized_module</span><span class="p">),</span>
<a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a>        <span class="s2">"metadata"</span><span class="p">:</span> <span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
<a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a>    <span class="p">}</span>
<a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a>
<a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span class="c1"># Store in database or file system</span>
<a href="#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span class="n">store_optimized_template</span><span class="p">(</span>
<a href="#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a>        <span class="n">template_name</span><span class="o">=</span><span class="n">template_name</span><span class="p">,</span>
<a href="#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a>        <span class="n">template_content</span><span class="o">=</span><span class="n">optimized_prompt</span><span class="p">,</span>
<a href="#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a>        <span class="n">version_info</span><span class="o">=</span><span class="n">version_info</span>
<a href="#__codelineno-4-20" id="__codelineno-4-20" name="__codelineno-4-20"></a>    <span class="p">)</span>
</code></pre></div> <h2 id="runtime-integration">Runtime Integration<a class="headerlink" href="#runtime-integration" title="Permanent link">¶</a></h2> <h3 id="using-optimized-prompts">Using Optimized Prompts<a class="headerlink" href="#using-optimized-prompts" title="Permanent link">¶</a></h3> <div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># app/integrations/dspy/runtime.py</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">app.prompts.store</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_best_template</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_optimized_prompt</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="sd">"""Get the best available prompt for this context."""</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>    <span class="c1"># Check for context-specific optimized version</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>    <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>        <span class="n">context_hash</span> <span class="o">=</span> <span class="n">hash_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>        <span class="n">context_optimized</span> <span class="o">=</span> <span class="n">get_template_for_context</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">context_hash</span><span class="p">)</span>
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>        <span class="k">if</span> <span class="n">context_optimized</span><span class="p">:</span>
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>            <span class="k">return</span> <span class="n">context_optimized</span>
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>    <span class="c1"># Fall back to best general version</span>
<a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a>    <span class="k">return</span> <span class="n">get_best_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
<a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a>
<a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_prompt</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">    </span><span class="sd">"""Apply a prompt with the given parameters."""</span>
<a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a>    <span class="c1"># Get optimized template</span>
<a href="#__codelineno-5-19" id="__codelineno-5-19" name="__codelineno-5-19"></a>    <span class="n">template</span> <span class="o">=</span> <span class="n">get_optimized_prompt</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'context'</span><span class="p">))</span>
<a href="#__codelineno-5-20" id="__codelineno-5-20" name="__codelineno-5-20"></a>
<a href="#__codelineno-5-21" id="__codelineno-5-21" name="__codelineno-5-21"></a>    <span class="c1"># Apply template parameters</span>
<a href="#__codelineno-5-22" id="__codelineno-5-22" name="__codelineno-5-22"></a>    <span class="n">filled_prompt</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a href="#__codelineno-5-23" id="__codelineno-5-23" name="__codelineno-5-23"></a>
<a href="#__codelineno-5-24" id="__codelineno-5-24" name="__codelineno-5-24"></a>    <span class="k">return</span> <span class="n">filled_prompt</span>
</code></pre></div> <h2 id="development-workflow">Development Workflow<a class="headerlink" href="#development-workflow" title="Permanent link">¶</a></h2> <p>DSPy prompt optimization integrates into the development workflow through:</p> <ol> <li><strong>CI/CD Integration</strong>: Automated optimization runs on PR</li> <li><strong>Dashboard</strong>: Visual comparison of prompt performance</li> <li><strong>A/B Testing</strong>: Systematic comparison of prompt variants</li> <li><strong>Usage Analytics</strong>: Tracking which prompts perform best in production</li> </ol> <div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># Example: CI/CD integration</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">ci_optimize_prompts</span><span class="p">(</span><span class="n">changed_files</span><span class="p">):</span>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="sd">"""Optimize prompts affected by code changes."""</span>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span class="n">affected_templates</span> <span class="o">=</span> <span class="n">find_affected_templates</span><span class="p">(</span><span class="n">changed_files</span><span class="p">)</span>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>    <span class="n">optimization_results</span> <span class="o">=</span> <span class="p">[]</span>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a>    <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">affected_templates</span><span class="p">:</span>
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a>        <span class="k">try</span><span class="p">:</span>
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>            <span class="n">optimized</span> <span class="o">=</span> <span class="n">optimize_prompt_template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a>            <span class="n">optimization_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a>                <span class="s2">"template"</span><span class="p">:</span> <span class="n">template</span><span class="p">,</span>
<a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a>                <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"success"</span><span class="p">,</span>
<a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a>                <span class="s2">"improvement"</span><span class="p">:</span> <span class="n">calculate_improvement</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">optimized</span><span class="p">)</span>
<a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a>            <span class="p">})</span>
<a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a>            <span class="n">optimization_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a>                <span class="s2">"template"</span><span class="p">:</span> <span class="n">template</span><span class="p">,</span>
<a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a>                <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"error"</span><span class="p">,</span>
<a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a>                <span class="s2">"error"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a>            <span class="p">})</span>
<a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a>
<a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a>    <span class="k">return</span> <span class="n">optimization_results</span>
</code></pre></div> <h2 id="benefits-over-traditional-approach">Benefits Over Traditional Approach<a class="headerlink" href="#benefits-over-traditional-approach" title="Permanent link">¶</a></h2> <table> <thead> <tr> <th>Traditional Prompt Engineering</th> <th>DSPy-Enhanced Approach</th> </tr> </thead> <tbody> <tr> <td>Manual trial and error</td> <td>Systematic optimization</td> </tr> <tr> <td>Subjective quality assessment</td> <td>Metric-driven evaluation</td> </tr> <tr> <td>Hard-coded templates</td> <td>Programmatic definition</td> </tr> <tr> <td>Ad-hoc versioning</td> <td>Systematic version control</td> </tr> <tr> <td>Context-blind templates</td> <td>Context-aware optimization</td> </tr> <tr> <td>Limited reuse</td> <td>Compositional building blocks</td> </tr> </tbody> </table> <h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">¶</a></h2> <ol> <li><strong>Start With Good Baselines</strong>: Begin with well-crafted manual prompts</li> <li><strong>Diverse Examples</strong>: Collect varied examples for optimization</li> <li><strong>Meaningful Metrics</strong>: Define metrics that align with user needs</li> <li><strong>Targeted Optimization</strong>: Optimize for specific contexts and tasks</li> <li><strong>Continuous Evaluation</strong>: Monitor prompt performance in production</li> <li><strong>Version Control</strong>: Track prompt evolution and enable rollbacks</li> </ol> <h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">¶</a></h2> <ul> <li>Prompt Management</li> <li>DSPy Integration Overview</li> <li>DSPy Technical Implementation</li> <li>DSPy Usage Examples</li> </ul> </div> </div><footer> <div aria-label="Footer Navigation" class="rst-footer-buttons" role="navigation"> <a class="btn btn-neutral float-left" href="../hybrid-model-selection/" title="Hybrid Selection"><span class="icon icon-circle-arrow-left"></span> Previous</a> <a class="btn btn-neutral float-right" href="../../model-integration/dspy-integration/" title="DSPy Integration">Next <span class="icon icon-circle-arrow-right"></span></a> </div> <hr/> <div role="contentinfo"> <!-- Copyright etc --> </div> Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. </footer> </div> </div> </section> </div> <div aria-label="Versions" class="rst-versions" role="note"> <span class="rst-current-version" data-toggle="rst-current-version"> <span><a href="../hybrid-model-selection/" style="color: #fcfcfc">« Previous</a></span> <span><a href="../../model-integration/dspy-integration/" style="color: #fcfcfc">Next »</a></span> </span> </div> <script src="../../js/jquery-3.6.0.min.js"></script> <script>var base_url = "../..";</script> <script src="../../js/theme_extra.js"></script> <script src="../../js/theme.js"></script> <script src="../../search/main.js"></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 