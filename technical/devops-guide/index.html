<!DOCTYPE html><html class=writer-html5 lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content=bebo><link rel="shortcut icon" href=../../img/favicon.ico><title>Developer Quickstart - Opossum Search Documentation</title><link rel=stylesheet href=../../css/theme.css><link rel=stylesheet href=../../css/theme_extra.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css><script>
        // Current page data
        var mkdocs_page_name = "Developer Quickstart";
        var mkdocs_page_input_path = "technical\\devops-guide.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js></script><script>hljs.highlightAll();</script></head> <body class=wy-body-for-nav role=document> <div class=wy-grid-for-nav> <nav data-toggle=wy-nav-shift class="wy-nav-side stickynav"> <div class=wy-side-scroll> <div class=wy-side-nav-search> <a href=../.. class="icon icon-home"> Opossum Search Documentation </a><div role=search> <form id=rtd-search-form class=wy-form action=../../search.html method=get> <input type=text name=q placeholder="Search docs" aria-label="Search docs" title="Type search term here"> </form> </div> </div> <div class="wy-menu wy-menu-vertical" data-spy=affix role=navigation aria-label="Navigation menu"> <ul> <li class=toctree-l1><a class="reference internal" href=../..>Home</a> </li> </ul> <p class=caption><span class=caption-text>Getting Started</span></p> <ul class=current> <li class=toctree-l1><a href=../getting-started/ class="reference internal">First Steps</a> </li> <li class=toctree-l1><a href=../system-architecture-overview/ class="reference internal">System Overview</a> </li> <li class=toctree-l1><a href=../../api/getting-started/ class="reference internal">API Reference</a> </li> <li class="toctree-l1 current"><a class="reference internal current" href=#>Developer Quickstart</a> <ul class=current> <li class=toctree-l2><a class="reference internal" href=#1-deployment-overview>1. Deployment Overview</a> </li> <li class=toctree-l2><a class="reference internal" href=#2-environment-setup>2. Environment Setup</a> <ul> <li class=toctree-l3><a class="reference internal" href=#21-system-requirements>2.1 System Requirements</a> </li> <li class=toctree-l3><a class="reference internal" href=#22-software-dependencies>2.2 Software Dependencies</a> </li> <li class=toctree-l3><a class="reference internal" href=#23-environment-configurations>2.3 Environment Configurations</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#3-installation-procedures>3. Installation Procedures</a> <ul> <li class=toctree-l3><a class="reference internal" href=#31-docker-based-deployment-recommended>3.1 Docker-based Deployment (Recommended)</a> <ul> <li class=toctree-l4><a class="reference internal" href=#docker-compose-file>Docker Compose File</a> </li> </ul> </li> <li class=toctree-l3><a class="reference internal" href=#32-kubernetes-deployment>3.2 Kubernetes Deployment</a> </li> <li class=toctree-l3><a class="reference internal" href=#33-manual-installation>3.3 Manual Installation</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#4-configuration-management>4. Configuration Management</a> <ul> <li class=toctree-l3><a class="reference internal" href=#41-environment-variables>4.1 Environment Variables</a> </li> <li class=toctree-l3><a class="reference internal" href=#42-configuration-files>4.2 Configuration Files</a> </li> <li class=toctree-l3><a class="reference internal" href=#43-secrets-management>4.3 Secrets Management</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#5-scaling-strategies>5. Scaling Strategies</a> <ul> <li class=toctree-l3><a class="reference internal" href=#51-horizontal-scaling>5.1 Horizontal Scaling</a> </li> <li class=toctree-l3><a class="reference internal" href=#52-redis-scaling>5.2 Redis Scaling</a> <ul> <li class=toctree-l4><a class="reference internal" href=#single-instance-configuration>Single Instance Configuration</a> </li> <li class=toctree-l4><a class="reference internal" href=#redis-sentinel-configuration>Redis Sentinel Configuration</a> </li> </ul> </li> <li class=toctree-l3><a class="reference internal" href=#53-model-optimization-for-scale>5.3 Model Optimization for Scale</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#6-monitoring-and-alerting>6. Monitoring and Alerting</a> <ul> <li class=toctree-l3><a class="reference internal" href=#61-health-checks>6.1 Health Checks</a> </li> <li class=toctree-l3><a class="reference internal" href=#62-prometheus-metrics>6.2 Prometheus Metrics</a> </li> <li class=toctree-l3><a class="reference internal" href=#63-alerting-configuration>6.3 Alerting Configuration</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#7-backup-and-recovery>7. Backup and Recovery</a> <ul> <li class=toctree-l3><a class="reference internal" href=#71-redis-backup>7.1 Redis Backup</a> </li> <li class=toctree-l3><a class="reference internal" href=#72-application-state-backup>7.2 Application State Backup</a> </li> <li class=toctree-l3><a class="reference internal" href=#73-recovery-procedures>7.3 Recovery Procedures</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#8-maintenance-procedures>8. Maintenance Procedures</a> <ul> <li class=toctree-l3><a class="reference internal" href=#81-model-updates>8.1 Model Updates</a> </li> <li class=toctree-l3><a class="reference internal" href=#82-dependency-updates>8.2 Dependency Updates</a> </li> <li class=toctree-l3><a class="reference internal" href=#83-performance-tuning>8.3 Performance Tuning</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#9-troubleshooting-common-issues>9. Troubleshooting Common Issues</a> <ul> <li class=toctree-l3><a class="reference internal" href=#91-service-unavailability>9.1 Service Unavailability</a> </li> <li class=toctree-l3><a class="reference internal" href=#92-performance-issues>9.2 Performance Issues</a> </li> <li class=toctree-l3><a class="reference internal" href=#93-debug-commands>9.3 Debug Commands</a> </li> </ul> </li> <li class=toctree-l2><a class="reference internal" href=#10-security-considerations>10. Security Considerations</a> <ul> <li class=toctree-l3><a class="reference internal" href=#101-api-key-rotation>10.1 API Key Rotation</a> </li> <li class=toctree-l3><a class="reference internal" href=#102-ssl-configuration>10.2 SSL Configuration</a> </li> </ul> </li> </ul> </li> </ul> <p class=caption><span class=caption-text>Core Components</span></p> <ul> <li class=toctree-l1><a class="reference internal">Architecture</a> <ul> <li class=toctree-l2><a href=../system-architecture-overview/ class="reference internal">System Overview</a> </li> <li class=toctree-l2><a href=../graphql-api/ class="reference internal">GraphQL API</a> </li> <li class=toctree-l2><a href=../security-model/ class="reference internal">Security Model</a> </li> </ul> </li> <li class=toctree-l1><a class="reference internal">Model Integration</a> <ul> <li class=toctree-l2><a href=../../model-integration/architecture/ class="reference internal">Architecture</a> </li> <li class=toctree-l2><a href=../../model-integration/backend-selection/ class="reference internal">Backend Selection</a> </li> <li class=toctree-l2><a href=../../model-integration/capability-matrix/ class="reference internal">Capability Matrix</a> </li> <li class=toctree-l2><a href=../../model-integration/providers/ class="reference internal">Provider Integration</a> </li> <li class=toctree-l2><a href=../../model-integration/configuration/ class="reference internal">Configuration</a> </li> <li class=toctree-l2><a href=../hybrid-model-selection/ class="reference internal">Hybrid Selection</a> </li> </ul> </li> <li class=toctree-l1><a class="reference internal">Service Availability</a> <ul> <li class=toctree-l2><a href=../../service-availability/context-and-scope/ class="reference internal">Context and Scope</a> </li> <li class=toctree-l2><a href=../../service-availability/quality-requirements/ class="reference internal">Quality Requirements</a> </li> <li class=toctree-l2><a href=../../service-availability/architecture-constraints/ class="reference internal">Architecture Constraints</a> </li> <li class=toctree-l2><a href=../../service-availability/availability-monitoring/ class="reference internal">Availability Monitoring</a> </li> <li class=toctree-l2><a href=../../service-availability/service-outage/ class="reference internal">Error Handling</a> </li> </ul> </li> <li class=toctree-l1><a class="reference internal">Resilience Patterns</a> <ul> <li class=toctree-l2><a href=../resilience-patterns/ class="reference internal">Core Strategies</a> </li> <li class=toctree-l2><a href=../error-handling-resilience/ class="reference internal">Error Handling</a> </li> <li class=toctree-l2><a href=../../service-availability/rate-limiting-throttling/ class="reference internal">Rate Limiting</a> </li> <li class=toctree-l2><a href=../../service-availability/log-alerts/ class="reference internal">Logging and Alerts</a> </li> <li class=toctree-l2><a href=../../service-availability/testing-validation/ class="reference internal">Testing and Validation</a> </li> </ul> </li> </ul> <p class=caption><span class=caption-text>Features</span></p> <ul> <li class=toctree-l1><a class="reference internal">Conversation</a> <ul> <li class=toctree-l2><a href=../../conversation/topic-detection/ class="reference internal">Topic Detection</a> </li> <li class=toctree-l2><a href=../../conversation/conversation-flow/ class="reference internal">Conversation Flow</a> </li> <li class=toctree-l2><a href=../../conversation/response-generation/ class="reference internal">Response Generation</a> </li> <li class=toctree-l2><a href=../../conversation/nlp-components/ class="reference internal">NLP Components</a> </li> <li class=toctree-l2><a href=../../conversation/markov-generation/ class="reference internal">Markov Generation</a> </li> </ul> </li> <li class=toctree-l1><a class="reference internal">Image Processing</a> <ul> <li class=toctree-l2><a href=../../image-processing/overview/ class="reference internal">Overview</a> </li> <li class=toctree-l2><a href=../../image-processing/effects/ class="reference internal">Effects and Filters</a> </li> <li class=toctree-l2><a href=../../image-processing/svg-generation/ class="reference internal">SVG Generation</a> </li> <li class=toctree-l2><a href=../../image-processing/optimization/ class="reference internal">Performance Optimization</a> </li> <li class=toctree-l2><a href=../../image-processing/caching/ class="reference internal">Caching Strategy</a> </li> </ul> </li> <li class=toctree-l1><a class="reference internal">Visualizations & Fun</a> <ul> <li class=toctree-l2><a href=../../features/service-vizualizations/ class="reference internal">Service Visualizations</a> </li> <li class=toctree-l2><a href=../../features/national-day/ class="reference internal">National Opossum Day</a> </li> <li class=toctree-l2><a href=../../features/easter-eggs/ class="reference internal">Easter Eggs</a> </li> <li class=toctree-l2><a href=../../features/special-events/ class="reference internal">Special Events</a> </li> <li class=toctree-l2><a href=../../features/background-stories/ class="reference internal">Background Stories</a> </li> </ul> </li> </ul> <p class=caption><span class=caption-text>Technical Reference</span></p> <ul> <li class=toctree-l1><a class="reference internal">Infrastructure</a> <ul> <li class=toctree-l2><a href=../redis-caching-architecture/ class="reference internal">Redis Caching</a> </li> <li class=toctree-l2><a href=../image-processing-pipeline/ class="reference internal">Image Pipeline</a> </li> <li class=toctree-l2><a href=../opentelemetry-integration/ class="reference internal">OpenTelemetry</a> </li> <li class=toctree-l2><a href=../svg-markup/ class="reference internal">SVG Markup</a> </li> <li class=toctree-l2><a href=../bot-user-simulation/ class="reference internal">Bot User Simulation</a> </li> <li class=toctree-l2><a href=../../infrastructure/optimization-strategies/ class="reference internal">Optimization Strategies</a> </li> </ul> </li> <li class=toctree-l1><a class="reference internal">API Documentation</a> <ul> <li class=toctree-l2><a href=../../api/routes/ class="reference internal">Routes</a> </li> <li class=toctree-l2><a href=../../api/request-response/ class="reference internal">Request/Response</a> </li> <li class=toctree-l2><a href=../../api/oauth-configuration/ class="reference internal">OAuth Configuration</a> </li> <li class=toctree-l2><a href=../../api/error-codes/ class="reference internal">Error Codes</a> </li> <li class=toctree-l2><a href=../../api/rate-limits/ class="reference internal">Rate Limits</a> </li> <li class=toctree-l2><a href=../../api/webhooks/ class="reference internal">Webhook Integration</a> </li> <li class=toctree-l2><a href=../../api/health-endpoints/ class="reference internal">Health Endpoints</a> </li> <li class=toctree-l2><a href=../../api/compliance/ class="reference internal">Compliance</a> </li> </ul> </li> </ul> <p class=caption><span class=caption-text>About</span></p> <ul> <li class=toctree-l1><a href=../../about/history/ class="reference internal">Project History</a> </li> <li class=toctree-l1><a href=../../about/team/ class="reference internal">Team</a> </li> <li class=toctree-l1><a href=../../about/roadmap/ class="reference internal">Roadmap</a> </li> </ul> </div> </div> </nav> <section data-toggle=wy-nav-shift class=wy-nav-content-wrap> <nav class=wy-nav-top role=navigation aria-label="Mobile navigation menu"> <i data-toggle=wy-nav-top class="fa fa-bars"></i> <a href=../..>Opossum Search Documentation</a> </nav> <div class=wy-nav-content> <div class=rst-content><div role=navigation aria-label="breadcrumbs navigation"> <ul class=wy-breadcrumbs> <li><a href=../.. class="icon icon-home" aria-label=Docs></a></li> <li class=breadcrumb-item>Getting Started</li> <li class="breadcrumb-item active">Developer Quickstart</li> <li class=wy-breadcrumbs-aside> </li> </ul> <hr> </div> <div role=main class=document itemscope=itemscope itemtype=http://schema.org/Article> <div class=section itemprop=articleBody> <h1 id=technical-documentation-deployment-operations-guide>Technical Documentation: Deployment &amp; Operations Guide<a class=headerlink href=#technical-documentation-deployment-operations-guide title="Permanent link">&para;</a></h1> <h2 id=1-deployment-overview>1. Deployment Overview<a class=headerlink href=#1-deployment-overview title="Permanent link">&para;</a></h2> <p>This guide outlines the processes and best practices for deploying, configuring, monitoring, and maintaining Opossum Search in various environments.</p> <h2 id=2-environment-setup>2. Environment Setup<a class=headerlink href=#2-environment-setup title="Permanent link">&para;</a></h2> <h3 id=21-system-requirements>2.1 System Requirements<a class=headerlink href=#21-system-requirements title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Component</th> <th>Minimum</th> <th>Recommended</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td>CPU</td> <td>2 cores</td> <td>4+ cores</td> <td>8+ cores for high-volume production</td> </tr> <tr> <td>RAM</td> <td>8GB</td> <td>16GB</td> <td>32GB+ for multiple local models</td> </tr> <tr> <td>Storage</td> <td>5GB</td> <td>20GB</td> <td>SSD recommended for model loading</td> </tr> <tr> <td>Network</td> <td>10Mbps</td> <td>100Mbps+</td> <td>Reliable connection for external APIs</td> </tr> <tr> <td>GPU</td> <td>None</td> <td>NVIDIA with 8GB+ VRAM</td> <td>For <a href=https://ollama.ai/ >Ollama</a> performance</td> </tr> </tbody> </table> <h3 id=22-software-dependencies>2.2 Software Dependencies<a class=headerlink href=#22-software-dependencies title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># Install system dependencies</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>sudo<span class=w> </span>apt-get<span class=w> </span>update
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=o>[</span>python3.11<span class=o>](</span>https://docs.python.org/3.11/<span class=o>)</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span>python3.11-dev<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>    </span>python3-pip<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>    </span>python3-venv<span class=w> </span><span class=se>\</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>    </span>redis-server<span class=w> </span><span class=c1># [Redis](https://redis.io/) in-memory data structure store</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>    </span>imagemagick<span class=w> </span><span class=c1># [ImageMagick](https://imagemagick.org/index.php) for image processing</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>    </span>libmagickwand-dev
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>    </span>build-essential
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=c1># Install NVIDIA drivers and CUDA toolkit (for GPU support)</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=c1># Skip this section if not using GPU</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>nvidia-driver-535<span class=w> </span>nvidia-cuda-toolkit
</code></pre></div> <h3 id=23-environment-configurations>2.3 Environment Configurations<a class=headerlink href=#23-environment-configurations title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Environment</th> <th>Description</th> <th>Use Case</th> </tr> </thead> <tbody> <tr> <td><code>development</code></td> <td>Local setup for developers</td> <td>Feature development, testing</td> </tr> <tr> <td><code>staging</code></td> <td>Production-like environment</td> <td>Integration testing, pre-release validation</td> </tr> <tr> <td><code>production</code></td> <td>Live deployment</td> <td>End-user service</td> </tr> </tbody> </table> <h2 id=3-installation-procedures>3. Installation Procedures<a class=headerlink href=#3-installation-procedures title="Permanent link">&para;</a></h2> <h3 id=31-docker-based-deployment-recommended>3.1 Docker-based Deployment (Recommended)<a class=headerlink href=#31-docker-based-deployment-recommended title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># Clone repository</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/yourusername/opossum-search.git
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=nb>cd</span><span class=w> </span>opossum-search
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1># Setup environment file</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>cp<span class=w> </span>.env.example<span class=w> </span>.env
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=c1># Edit .env file with appropriate settings</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=c1># Start with Docker Compose</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</code></pre></div> <h4 id=docker-compose-file>Docker Compose File<a class=headerlink href=#docker-compose-file title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># docker-compose.yml</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=nt>services</span><span class=p>:</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>  </span><span class=nt>app</span><span class=p>:</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8000:8000&quot;</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_HOST=redis</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ENV=production</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GEMINI_API_KEY=${GEMINI_API_KEY}</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4318/v1/traces</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ollama</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./models:/app/models</span>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./config:/app/config</span>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=w>  </span><span class=nt>redis</span><span class=p>:</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:7.0-alpine</span>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;6379:6379&quot;</span>
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-server --appendonly yes</span>
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-data:/data</span>
<a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>
<a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a><span class=w>  </span><span class=nt>ollama</span><span class=p>:</span>
<a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ollama/ollama:latest</span>
<a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;11434:11434&quot;</span>
<a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ollama-models:/root/.ollama</span>
<a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
<a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a><span class=w>        </span><span class=nt>reservations</span><span class=p>:</span>
<a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a><span class=w>          </span><span class=nt>devices</span><span class=p>:</span>
<a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nvidia</span>
<a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a><span class=w>              </span><span class=nt>count</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a><span class=w>              </span><span class=nt>capabilities</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>gpu</span><span class="p p-Indicator">]</span>
<a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a>
<a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a><span class=w>  </span><span class=nt>otel-collector</span><span class=p>:</span>
<a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">otel/opentelemetry-collector:0.97.0</span>
<a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;--config=/etc/otel-config.yaml&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-2-49 name=__codelineno-2-49 href=#__codelineno-2-49></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-2-50 name=__codelineno-2-50 href=#__codelineno-2-50></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./otel-config.yaml:/etc/otel-config.yaml</span>
<a id=__codelineno-2-51 name=__codelineno-2-51 href=#__codelineno-2-51></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-2-52 name=__codelineno-2-52 href=#__codelineno-2-52></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;4318:4318&quot;</span>
<a id=__codelineno-2-53 name=__codelineno-2-53 href=#__codelineno-2-53></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;9464:9464&quot;</span>
<a id=__codelineno-2-54 name=__codelineno-2-54 href=#__codelineno-2-54></a>
<a id=__codelineno-2-55 name=__codelineno-2-55 href=#__codelineno-2-55></a><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span>
<a id=__codelineno-2-56 name=__codelineno-2-56 href=#__codelineno-2-56></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jaegertracing/all-in-one:latest</span>
<a id=__codelineno-2-57 name=__codelineno-2-57 href=#__codelineno-2-57></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-2-58 name=__codelineno-2-58 href=#__codelineno-2-58></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;16686:16686&quot;</span>
<a id=__codelineno-2-59 name=__codelineno-2-59 href=#__codelineno-2-59></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;14250:14250&quot;</span>
<a id=__codelineno-2-60 name=__codelineno-2-60 href=#__codelineno-2-60></a>
<a id=__codelineno-2-61 name=__codelineno-2-61 href=#__codelineno-2-61></a><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-2-62 name=__codelineno-2-62 href=#__codelineno-2-62></a><span class=w>  </span><span class=nt>redis-data</span><span class=p>:</span>
<a id=__codelineno-2-63 name=__codelineno-2-63 href=#__codelineno-2-63></a><span class=w>  </span><span class=nt>ollama-models</span><span class=p>:</span>
</code></pre></div> <h3 id=32-kubernetes-deployment>3.2 Kubernetes Deployment<a class=headerlink href=#32-kubernetes-deployment title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># app-deployment.yaml</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-search</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-search</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-search</span>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-search</span>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-search:latest</span>
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_HOST</span>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis-service</span>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ENV</span>
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GEMINI_API_KEY</span>
<a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span>
<a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span>
<a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api-keys</span>
<a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gemini-api-key</span>
<a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a><span class=w>        </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a><span class=w>          </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;512Mi&quot;</span>
<a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;500m&quot;</span>
<a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a><span class=w>          </span><span class=nt>limits</span><span class=p>:</span>
<a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2Gi&quot;</span>
<a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2000m&quot;</span>
</code></pre></div> <h3 id=33-manual-installation>3.3 Manual Installation<a class=headerlink href=#33-manual-installation title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># Clone repository</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/yourusername/opossum-search.git
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=nb>cd</span><span class=w> </span>opossum-search
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=c1># Create virtual environment</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>python<span class=w> </span>-m<span class=w> </span>venv<span class=w> </span>venv
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=nb>source</span><span class=w> </span>venv/bin/activate
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=c1># Install dependencies</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=c1># Setup environment</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>cp<span class=w> </span>.env.example<span class=w> </span>.env
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=c1># Edit .env file with appropriate settings</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=c1># Run application</span>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>python<span class=w> </span>-m<span class=w> </span>app
</code></pre></div> <h2 id=4-configuration-management>4. Configuration Management<a class=headerlink href=#4-configuration-management title="Permanent link">&para;</a></h2> <h3 id=41-environment-variables>4.1 Environment Variables<a class=headerlink href=#41-environment-variables title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Variable</th> <th>Purpose</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><code>ENV</code></td> <td>Deployment environment</td> <td><code>production</code></td> </tr> <tr> <td><code>DEBUG</code></td> <td>Enable debug mode</td> <td><code>False</code></td> </tr> <tr> <td><code>GEMINI_API_KEY</code></td> <td>API key for <a href=https://ai.google.dev/ >Gemini</a></td> <td><code>your-api-key</code></td> </tr> <tr> <td><code>REDIS_HOST</code></td> <td><a href=https://redis.io/ >Redis</a> server hostname</td> <td><code>redis</code></td> </tr> <tr> <td><code>REDIS_PORT</code></td> <td><a href=https://redis.io/ >Redis</a> server port</td> <td><code>6379</code></td> </tr> <tr> <td><code>REDIS_PASSWORD</code></td> <td><a href=https://redis.io/ >Redis</a> password</td> <td><code>secure-password</code></td> </tr> <tr> <td><code>OLLAMA_BASE_URL</code></td> <td><a href=https://ollama.ai/ >Ollama</a> server URL</td> <td><code>http://ollama:11434</code></td> </tr> <tr> <td><code>OTEL_EXPORTER_OTLP_ENDPOINT</code></td> <td><a href=https://opentelemetry.io/ >OpenTelemetry</a> collector</td> <td><code>http://otel-collector:4318</code></td> </tr> </tbody> </table> <h3 id=42-configuration-files>4.2 Configuration Files<a class=headerlink href=#42-configuration-files title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># config/production.py</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=sd>&quot;&quot;&quot;Production environment configuration&quot;&quot;&quot;</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=c1># API settings</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=n>API_KEY_REQUIRED</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=n>GRAPHQL_GRAPHIQL</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=n>VOYAGER_ENABLED</span> <span class=o>=</span> <span class=kc>False</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=c1># Rate limits</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=n>RATE_LIMITS</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    <span class=s2>&quot;default&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;100 per day&quot;</span><span class=p>,</span> <span class=s2>&quot;10 per minute&quot;</span><span class=p>],</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>    <span class=s2>&quot;admin&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;1000 per day&quot;</span><span class=p>,</span> <span class=s2>&quot;100 per minute&quot;</span><span class=p>],</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=p>}</span>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=c1># Cache settings</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=n>CACHE_TTL</span> <span class=o>=</span> <span class=mi>3600</span>  <span class=c1># 1 hour</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=n>MODEL_SELECTION_CACHE_TTL</span> <span class=o>=</span> <span class=mi>60</span>  <span class=c1># 1 minute</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=n>AVAILABILITY_CACHE_TTL</span> <span class=o>=</span> <span class=mi>30</span>  <span class=c1># 30 seconds</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=c1># Model configuration</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=n>DEFAULT_MODEL</span> <span class=o>=</span> <span class=s2>&quot;transformers&quot;</span>
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=n>PREWARM_MODELS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;transformers&quot;</span><span class=p>]</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=n>ERROR_THRESHOLD</span> <span class=o>=</span> <span class=mi>5</span>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=c1># Security settings</span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=n>CORS_ALLOWED_ORIGINS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;https://app.yourdomain.com&quot;</span><span class=p>]</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=n>CORS_ALLOW_CREDENTIALS</span> <span class=o>=</span> <span class=kc>True</span>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=n>MAX_IMAGE_SIZE</span> <span class=o>=</span> <span class=mi>10</span> <span class=o>*</span> <span class=mi>1024</span> <span class=o>*</span> <span class=mi>1024</span>  <span class=c1># 10MB</span>
</code></pre></div> <h3 id=43-secrets-management>4.3 Secrets Management<a class=headerlink href=#43-secrets-management title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Create Kubernetes secrets</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>api-keys<span class=w> </span><span class=se>\</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>  </span>--from-literal<span class=o>=</span>gemini-api-key<span class=o>=</span>your-gemini-api-key<span class=w> </span><span class=se>\</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>  </span>--from-literal<span class=o>=</span>redis-password<span class=o>=</span>your-redis-password
</code></pre></div> <h2 id=5-scaling-strategies>5. Scaling Strategies<a class=headerlink href=#5-scaling-strategies title="Permanent link">&para;</a></h2> <h3 id=51-horizontal-scaling>5.1 Horizontal Scaling<a class=headerlink href=#51-horizontal-scaling title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># Kubernetes HPA configuration</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">autoscaling/v2</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HorizontalPodAutoscaler</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-search-hpa</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>  </span><span class=nt>scaleTargetRef</span><span class=p>:</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-search</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>  </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>  </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Resource</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=w>    </span><span class=nt>resource</span><span class=p>:</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cpu</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>      </span><span class=nt>target</span><span class=p>:</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Utilization</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">70</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Resource</span>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=w>    </span><span class=nt>resource</span><span class=p>:</span>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">memory</span>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=w>      </span><span class=nt>target</span><span class=p>:</span>
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Utilization</span>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div> <h3 id=52-redis-scaling>5.2 Redis Scaling<a class=headerlink href=#52-redis-scaling title="Permanent link">&para;</a></h3> <h4 id=single-instance-configuration>Single Instance Configuration<a class=headerlink href=#single-instance-configuration title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a># redis.conf for single instance
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>maxmemory 1gb
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>maxmemory-policy allkeys-lru
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>appendonly yes
</code></pre></div> <h4 id=redis-sentinel-configuration>Redis Sentinel Configuration<a class=headerlink href=#redis-sentinel-configuration title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a># sentinel.conf
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>sentinel monitor mymaster redis-master 6379 2
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>sentinel down-after-milliseconds mymaster 5000
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>sentinel failover-timeout mymaster 60000
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>sentinel parallel-syncs mymaster 1
</code></pre></div> <h3 id=53-model-optimization-for-scale>5.3 Model Optimization for Scale<a class=headerlink href=#53-model-optimization-for-scale title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># Example model optimization settings for scaled deployments</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>MODEL_CONFIGS</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=s2>&quot;gemini-thinking&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>        <span class=s2>&quot;api_name&quot;</span><span class=p>:</span> <span class=s2>&quot;gemini-1.5-pro&quot;</span><span class=p>,</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>        <span class=s2>&quot;max_tokens&quot;</span><span class=p>:</span> <span class=mi>1024</span><span class=p>,</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>        <span class=s2>&quot;temperature&quot;</span><span class=p>:</span> <span class=mf>0.7</span><span class=p>,</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>        <span class=s2>&quot;top_p&quot;</span><span class=p>:</span> <span class=mf>0.95</span><span class=p>,</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>    <span class=p>},</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>    <span class=s2>&quot;gemma&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>        <span class=s2>&quot;top_k&quot;</span><span class=p>:</span> <span class=mi>40</span><span class=p>,</span>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>        <span class=s2>&quot;temperature&quot;</span><span class=p>:</span> <span class=mf>0.8</span><span class=p>,</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>        <span class=s2>&quot;response_format&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;text&quot;</span><span class=p>},</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>    <span class=p>},</span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>    <span class=s2>&quot;transformers&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>        <span class=s2>&quot;transformers_name&quot;</span><span class=p>:</span> <span class=s2>&quot;google/gemma-2b&quot;</span><span class=p>,</span>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>        <span class=s2>&quot;max_length&quot;</span><span class=p>:</span> <span class=mi>512</span><span class=p>,</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>        <span class=s2>&quot;device_map&quot;</span><span class=p>:</span> <span class=s2>&quot;auto&quot;</span><span class=p>,</span>  <span class=c1># Automatically select best device</span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>    <span class=p>}</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=p>}</span>
</code></pre></div> <h2 id=6-monitoring-and-alerting>6. Monitoring and Alerting<a class=headerlink href=#6-monitoring-and-alerting title="Permanent link">&para;</a></h2> <h3 id=61-health-checks>6.1 Health Checks<a class=headerlink href=#61-health-checks title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># app/api/health.py</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/health&quot;</span><span class=p>)</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>health_check</span><span class=p>():</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;System health check&quot;&quot;&quot;</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>    <span class=n>status</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>        <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;ok&quot;</span><span class=p>,</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>        <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>Config</span><span class=o>.</span><span class=n>VERSION</span><span class=p>,</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>        <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>        <span class=s2>&quot;services&quot;</span><span class=p>:</span> <span class=p>{}</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>    <span class=p>}</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>    <span class=c1># Check Redis</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>        <span class=n>redis_ping</span> <span class=o>=</span> <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>ping</span><span class=p>()</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>        <span class=n>status</span><span class=p>[</span><span class=s2>&quot;services&quot;</span><span class=p>][</span><span class=s2>&quot;redis&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;ok&quot;</span> <span class=k>if</span> <span class=n>redis_ping</span> <span class=k>else</span> <span class=s2>&quot;error&quot;</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>        <span class=n>status</span><span class=p>[</span><span class=s2>&quot;services&quot;</span><span class=p>][</span><span class=s2>&quot;redis&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>    <span class=c1># Check Ollama</span>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>        <span class=k>async</span> <span class=k>with</span> <span class=n>httpx</span><span class=o>.</span><span class=n>AsyncClient</span><span class=p>()</span> <span class=k>as</span> <span class=n>client</span><span class=p>:</span>
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>            <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>Config</span><span class=o>.</span><span class=n>OLLAMA_BASE_URL</span><span class=si>}</span><span class=s2>/api/tags&quot;</span><span class=p>)</span>
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>            <span class=n>status</span><span class=p>[</span><span class=s2>&quot;services&quot;</span><span class=p>][</span><span class=s2>&quot;ollama&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;ok&quot;</span> <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span> <span class=k>else</span> <span class=s2>&quot;error&quot;</span>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>        <span class=n>status</span><span class=p>[</span><span class=s2>&quot;services&quot;</span><span class=p>][</span><span class=s2>&quot;ollama&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a>
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a>    <span class=c1># Check model availability</span>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a>    <span class=n>service_monitor</span> <span class=o>=</span> <span class=n>ServiceMonitor</span><span class=p>()</span>
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a>    <span class=k>await</span> <span class=n>service_monitor</span><span class=o>.</span><span class=n>check_all_services</span><span class=p>()</span>
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a>    <span class=n>status</span><span class=p>[</span><span class=s2>&quot;services&quot;</span><span class=p>][</span><span class=s2>&quot;model_backends&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a>        <span class=n>k</span><span class=p>:</span> <span class=s2>&quot;available&quot;</span> <span class=k>if</span> <span class=n>v</span> <span class=k>else</span> <span class=s2>&quot;unavailable&quot;</span>
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a>        <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>service_monitor</span><span class=o>.</span><span class=n>services</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a>    <span class=p>}</span>
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a>
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a>    <span class=c1># Set overall status</span>
<a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a>    <span class=k>if</span> <span class=nb>any</span><span class=p>(</span><span class=n>v</span> <span class=o>!=</span> <span class=s2>&quot;ok&quot;</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>v</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;available&quot;</span><span class=p>)</span> 
<a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a>           <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=p>[</span><span class=o>*</span><span class=n>status</span><span class=p>[</span><span class=s2>&quot;services&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>(),</span> <span class=o>*</span><span class=n>status</span><span class=p>[</span><span class=s2>&quot;services&quot;</span><span class=p>][</span><span class=s2>&quot;model_backends&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>()]):</span>
<a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a>        <span class=n>status</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;degraded&quot;</span>
<a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a>
<a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a>    <span class=k>return</span> <span class=n>status</span>
</code></pre></div> <h3 id=62-prometheus-metrics>6.2 Prometheus Metrics<a class=headerlink href=#62-prometheus-metrics title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># app/monitoring/metrics.py</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=kn>from</span><span class=w> </span><span class=nn>prometheus_client</span><span class=w> </span><span class=kn>import</span> <span class=n>Counter</span><span class=p>,</span> <span class=n>Histogram</span><span class=p>,</span> <span class=n>Gauge</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=c1># Define metrics</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=n>REQUESTS_TOTAL</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>    <span class=s2>&quot;opossum_requests_total&quot;</span><span class=p>,</span> 
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>    <span class=s2>&quot;Total number of requests&quot;</span><span class=p>,</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>    <span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>,</span> <span class=s2>&quot;endpoint&quot;</span><span class=p>]</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=p>)</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=n>RESPONSE_TIME</span> <span class=o>=</span> <span class=n>Histogram</span><span class=p>(</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>    <span class=s2>&quot;opossum_response_time_seconds&quot;</span><span class=p>,</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>    <span class=s2>&quot;Response time in seconds&quot;</span><span class=p>,</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>    <span class=p>[</span><span class=s2>&quot;method&quot;</span><span class=p>,</span> <span class=s2>&quot;endpoint&quot;</span><span class=p>]</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=p>)</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=n>MODEL_USAGE</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>    <span class=s2>&quot;opossum_model_usage_total&quot;</span><span class=p>,</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>    <span class=s2>&quot;Total model usage count&quot;</span><span class=p>,</span>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a>    <span class=p>[</span><span class=s2>&quot;model_name&quot;</span><span class=p>]</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=p>)</span>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=n>CACHE_HITS</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a>    <span class=s2>&quot;opossum_cache_hits_total&quot;</span><span class=p>,</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>    <span class=s2>&quot;Total cache hits&quot;</span><span class=p>,</span>
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a>    <span class=p>[</span><span class=s2>&quot;cache_type&quot;</span><span class=p>]</span>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a><span class=p>)</span>
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a><span class=n>CACHE_MISSES</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span>
<a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a>    <span class=s2>&quot;opossum_cache_misses_total&quot;</span><span class=p>,</span>
<a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a>    <span class=s2>&quot;Total cache misses&quot;</span><span class=p>,</span>
<a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a>    <span class=p>[</span><span class=s2>&quot;cache_type&quot;</span><span class=p>]</span>
<a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a><span class=p>)</span>
<a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a>
<a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a><span class=n>SERVICE_AVAILABILITY</span> <span class=o>=</span> <span class=n>Gauge</span><span class=p>(</span>
<a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a>    <span class=s2>&quot;opossum_service_availability&quot;</span><span class=p>,</span>
<a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a>    <span class=s2>&quot;Service availability status (1=available, 0=unavailable)&quot;</span><span class=p>,</span>
<a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a>    <span class=p>[</span><span class=s2>&quot;service_name&quot;</span><span class=p>]</span>
<a id=__codelineno-12-39 name=__codelineno-12-39 href=#__codelineno-12-39></a><span class=p>)</span>
</code></pre></div> <h3 id=63-alerting-configuration>6.3 Alerting Configuration<a class=headerlink href=#63-alerting-configuration title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1># prometheus/alert-rules.yml</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=nt>groups</span><span class=p>:</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-alerts</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HighErrorRate</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>    </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rate(opossum_requests_total{status=&quot;error&quot;}[5m]) / rate(opossum_requests_total[5m]) &gt; 0.05</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>    </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2m</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>    </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=w>    </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>      </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s>&quot;High</span><span class=nv> </span><span class=s>error</span><span class=nv> </span><span class=s>rate</span><span class=nv> </span><span class=s>detected&quot;</span>
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Error</span><span class=nv> </span><span class=s>rate</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>above</span><span class=nv> </span><span class=s>5%</span><span class=nv> </span><span class=s>for</span><span class=nv> </span><span class=s>the</span><span class=nv> </span><span class=s>last</span><span class=nv> </span><span class=s>2</span><span class=nv> </span><span class=s>minutes&quot;</span>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ServiceUnavailable</span>
<a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>    </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum_service_availability == 0</span>
<a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>    </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>    </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>    </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>      </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Service</span><span class=nv> </span><span class=s>unavailable&quot;</span>
<a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>$labels.service_name</span><span class=nv> </span><span class=s>}}</span><span class=nv> </span><span class=s>has</span><span class=nv> </span><span class=s>been</span><span class=nv> </span><span class=s>unavailable</span><span class=nv> </span><span class=s>for</span><span class=nv> </span><span class=s>5</span><span class=nv> </span><span class=s>minutes&quot;</span>
<a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a>
<a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>alert</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HighResponseTime</span>
<a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=w>    </span><span class=nt>expr</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">histogram_quantile(0.95, rate(opossum_response_time_seconds_bucket[5m])) &gt; 2</span>
<a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=w>    </span><span class=nt>for</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=w>    </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a><span class=w>      </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a><span class=w>    </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a><span class=w>      </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s>&quot;High</span><span class=nv> </span><span class=s>response</span><span class=nv> </span><span class=s>time&quot;</span>
<a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;95th</span><span class=nv> </span><span class=s>percentile</span><span class=nv> </span><span class=s>response</span><span class=nv> </span><span class=s>time</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>above</span><span class=nv> </span><span class=s>2</span><span class=nv> </span><span class=s>seconds</span><span class=nv> </span><span class=s>for</span><span class=nv> </span><span class=s>5</span><span class=nv> </span><span class=s>minutes&quot;</span>
</code></pre></div> <h2 id=7-backup-and-recovery>7. Backup and Recovery<a class=headerlink href=#7-backup-and-recovery title="Permanent link">&para;</a></h2> <h3 id=71-redis-backup>7.1 Redis Backup<a class=headerlink href=#71-redis-backup title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># Automated Redis backup script</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=nv>BACKUP_DIR</span><span class=o>=</span><span class=s2>&quot;/backups/redis&quot;</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=nv>TIMESTAMP</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%Y%m%d%H%M%S<span class=k>)</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=nv>BACKUP_FILE</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/redis-</span><span class=nv>$TIMESTAMP</span><span class=s2>.rdb&quot;</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=c1># Ensure backup directory exists</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>mkdir<span class=w> </span>-p<span class=w> </span><span class=nv>$BACKUP_DIR</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=c1># Trigger Redis save</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>redis-cli<span class=w> </span>save
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=c1># Copy RDB file</span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>cp<span class=w> </span>/var/lib/redis/dump.rdb<span class=w> </span><span class=nv>$BACKUP_FILE</span>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=c1># Compress backup</span>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>gzip<span class=w> </span><span class=nv>$BACKUP_FILE</span>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=c1># Keep last 7 days of backups</span>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a>find<span class=w> </span><span class=nv>$BACKUP_DIR</span><span class=w> </span>-name<span class=w> </span><span class=s2>&quot;redis-*.rdb.gz&quot;</span><span class=w> </span>-mtime<span class=w> </span>+7<span class=w> </span>-delete
</code></pre></div> <h3 id=72-application-state-backup>7.2 Application State Backup<a class=headerlink href=#72-application-state-backup title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=c1># app/management/backup.py</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>export_system_state</span><span class=p>():</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Export critical system state&quot;&quot;&quot;</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    <span class=n>state</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>        <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>        <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>Config</span><span class=o>.</span><span class=n>VERSION</span><span class=p>,</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>        <span class=s2>&quot;service_status&quot;</span><span class=p>:</span> <span class=p>{},</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>        <span class=s2>&quot;model_weights&quot;</span><span class=p>:</span> <span class=p>{},</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>        <span class=s2>&quot;cache_stats&quot;</span><span class=p>:</span> <span class=p>{}</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>    <span class=p>}</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>    <span class=c1># Get service availability</span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>    <span class=n>service_monitor</span> <span class=o>=</span> <span class=n>ServiceMonitor</span><span class=p>()</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>    <span class=k>await</span> <span class=n>service_monitor</span><span class=o>.</span><span class=n>check_all_services</span><span class=p>()</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>    <span class=n>state</span><span class=p>[</span><span class=s2>&quot;service_status&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>service_monitor</span><span class=o>.</span><span class=n>services</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>    <span class=c1># Get model selection weights</span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a>    <span class=n>backend</span> <span class=o>=</span> <span class=n>HybridModelBackend</span><span class=p>()</span>
<a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a>    <span class=n>state</span><span class=p>[</span><span class=s2>&quot;model_weights&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>backend</span><span class=o>.</span><span class=n>get_model_weights</span><span class=p>()</span>
<a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a>
<a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a>    <span class=c1># Get cache statistics</span>
<a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a>    <span class=n>cache_stats</span> <span class=o>=</span> <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;stats&quot;</span><span class=p>)</span>
<a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a>    <span class=n>state</span><span class=p>[</span><span class=s2>&quot;cache_stats&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a>        <span class=s2>&quot;hits&quot;</span><span class=p>:</span> <span class=n>cache_stats</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;keyspace_hits&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
<a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a>        <span class=s2>&quot;misses&quot;</span><span class=p>:</span> <span class=n>cache_stats</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;keyspace_misses&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
<a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a>        <span class=s2>&quot;keys&quot;</span><span class=p>:</span> <span class=k>await</span> <span class=n>redis_client</span><span class=o>.</span><span class=n>dbsize</span><span class=p>()</span>
<a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a>    <span class=p>}</span>
<a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a>
<a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a>    <span class=c1># Export to file</span>
<a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a>    <span class=n>export_path</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;backups/state-</span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y%m</span><span class=si>%d</span><span class=s1>%H%M%S&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>.json&quot;</span>
<a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>export_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
<a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
<a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a>
<a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a>    <span class=k>return</span> <span class=n>export_path</span>
</code></pre></div> <h3 id=73-recovery-procedures>7.3 Recovery Procedures<a class=headerlink href=#73-recovery-procedures title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1># Redis recovery</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=nv>BACKUP_FILE</span><span class=o>=</span><span class=nv>$1</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_FILE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Usage: </span><span class=nv>$0</span><span class=s2> backup-file.rdb.gz&quot;</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=k>fi</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=c1># Stop Redis</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>sudo<span class=w> </span>systemctl<span class=w> </span>stop<span class=w> </span>redis-server
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=c1># Decompress backup if needed</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$BACKUP_FILE</span><span class=w> </span><span class=o>==</span><span class=w> </span>*.gz<span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=w>    </span>gunzip<span class=w> </span>-c<span class=w> </span><span class=nv>$BACKUP_FILE</span><span class=w> </span>&gt;<span class=w> </span>/tmp/dump.rdb
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=w>    </span><span class=nv>BACKUP_FILE</span><span class=o>=</span><span class=s2>&quot;/tmp/dump.rdb&quot;</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=k>fi</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=c1># Replace Redis data file</span>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a>sudo<span class=w> </span>cp<span class=w> </span><span class=nv>$BACKUP_FILE</span><span class=w> </span>/var/lib/redis/dump.rdb
<a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a>sudo<span class=w> </span>chown<span class=w> </span>redis:redis<span class=w> </span>/var/lib/redis/dump.rdb
<a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a>
<a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a><span class=c1># Start Redis</span>
<a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a>sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>redis-server
<a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a>
<a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a><span class=c1># Verify Redis is running</span>
<a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a>redis-cli<span class=w> </span>ping
</code></pre></div> <h2 id=8-maintenance-procedures>8. Maintenance Procedures<a class=headerlink href=#8-maintenance-procedures title="Permanent link">&para;</a></h2> <h3 id=81-model-updates>8.1 Model Updates<a class=headerlink href=#81-model-updates title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1># Update Ollama models script</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=nv>MODELS</span><span class=o>=(</span><span class=s2>&quot;gemma:latest&quot;</span><span class=w> </span><span class=s2>&quot;llava:latest&quot;</span><span class=w> </span><span class=s2>&quot;all-minilm:latest&quot;</span><span class=o>)</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=k>for</span><span class=w> </span>MODEL<span class=w> </span><span class=k>in</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>MODELS</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Updating </span><span class=nv>$MODEL</span><span class=s2>...&quot;</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>    </span>ollama<span class=w> </span>pull<span class=w> </span><span class=nv>$MODEL</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=k>done</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=c1># Verify models</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a>ollama<span class=w> </span>list
</code></pre></div> <h3 id=82-dependency-updates>8.2 Dependency Updates<a class=headerlink href=#82-dependency-updates title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># Update dependencies</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>pip<span class=w> </span>install<span class=w> </span>--upgrade<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=c1># Check for security vulnerabilities</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>pip-audit
</code></pre></div> <h3 id=83-performance-tuning>8.3 Performance Tuning<a class=headerlink href=#83-performance-tuning title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># Example memory optimization settings</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=kn>import</span><span class=w> </span><span class=nn>torch</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=k>def</span><span class=w> </span><span class=nf>optimize_for_environment</span><span class=p>():</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Apply optimal settings based on environment&quot;&quot;&quot;</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>    <span class=n>total_memory</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>get_device_properties</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>total_memory</span> <span class=k>if</span> <span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>is_available</span><span class=p>()</span> <span class=k>else</span> <span class=mi>0</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>    <span class=k>if</span> <span class=n>torch</span><span class=o>.</span><span class=n>cuda</span><span class=o>.</span><span class=n>is_available</span><span class=p>():</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>        <span class=k>if</span> <span class=n>total_memory</span> <span class=o>&gt;</span> <span class=mi>8</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1024</span><span class=o>**</span><span class=mi>3</span><span class=p>):</span>  <span class=c1># More than 8GB VRAM</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>            <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>                <span class=s2>&quot;device_map&quot;</span><span class=p>:</span> <span class=s2>&quot;auto&quot;</span><span class=p>,</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>                <span class=s2>&quot;load_in_8bit&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a>                <span class=s2>&quot;torch_dtype&quot;</span><span class=p>:</span> <span class=n>torch</span><span class=o>.</span><span class=n>float16</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>            <span class=p>}</span>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>        <span class=k>else</span><span class=p>:</span>  <span class=c1># Less than 8GB VRAM</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a>            <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a>                <span class=s2>&quot;device_map&quot;</span><span class=p>:</span> <span class=s2>&quot;auto&quot;</span><span class=p>,</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a>                <span class=s2>&quot;load_in_8bit&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a>                <span class=s2>&quot;torch_dtype&quot;</span><span class=p>:</span> <span class=n>torch</span><span class=o>.</span><span class=n>float16</span>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a>            <span class=p>}</span>
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a>    <span class=k>else</span><span class=p>:</span>  <span class=c1># CPU only</span>
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a>        <span class=k>return</span> <span class=p>{</span>
<a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a>            <span class=s2>&quot;device_map&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;&quot;</span><span class=p>:</span> <span class=s2>&quot;cpu&quot;</span><span class=p>},</span>
<a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a>            <span class=s2>&quot;low_cpu_mem_usage&quot;</span><span class=p>:</span> <span class=kc>True</span>
<a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a>        <span class=p>}</span>
</code></pre></div> <h2 id=9-troubleshooting-common-issues>9. Troubleshooting Common Issues<a class=headerlink href=#9-troubleshooting-common-issues title="Permanent link">&para;</a></h2> <h3 id=91-service-unavailability>9.1 Service Unavailability<a class=headerlink href=#91-service-unavailability title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Issue</th> <th>Diagnosis</th> <th>Resolution</th> </tr> </thead> <tbody> <tr> <td><a href=https://ai.google.dev/ >Gemini API</a> unavailable</td> <td>Check API key validity and rate limits</td> <td>Verify API key and check Google Cloud console for quota</td> </tr> <tr> <td><a href=https://ollama.ai/ >Ollama</a> service down</td> <td>Check logs with <code>docker logs ollama</code></td> <td>Restart service and verify model availability</td> </tr> <tr> <td><a href=https://redis.io/ >Redis</a> connection error</td> <td>Check <a href=https://redis.io/ >Redis</a> logs and connectivity</td> <td>Verify <a href=https://redis.io/ >Redis</a> is running and properly configured</td> </tr> </tbody> </table> <h3 id=92-performance-issues>9.2 Performance Issues<a class=headerlink href=#92-performance-issues title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Issue</th> <th>Diagnosis</th> <th>Resolution</th> </tr> </thead> <tbody> <tr> <td>High response time</td> <td>Check request concurrency and model performance</td> <td>Scale horizontally and optimize model selection weights</td> </tr> <tr> <td>Memory leaks</td> <td>Monitor memory usage over time</td> <td>Implement proper garbage collection and restart services</td> </tr> <tr> <td>Slow image processing</td> <td>Check image size and transformation pipeline</td> <td>Optimize image processing parameters and caching</td> </tr> </tbody> </table> <h3 id=93-debug-commands>9.3 Debug Commands<a class=headerlink href=#93-debug-commands title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># Check service health</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>curl<span class=w> </span>http://localhost:8000/health
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=c1># View service logs</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>docker<span class=w> </span>logs<span class=w> </span>opossum-search-app
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=c1># Check Redis performance</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>redis-cli<span class=w> </span>info<span class=w> </span>stats
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=c1># Monitor API performance</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a>curl<span class=w> </span>http://localhost:8000/metrics
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=c1># Test model availability</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>http://localhost:11434/api/generate<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;{</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=s1>  &quot;model&quot;: &quot;gemma&quot;,</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=s1>  &quot;prompt&quot;: &quot;Hello&quot;,</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=s1>  &quot;stream&quot;: false</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=s1>}&#39;</span>
</code></pre></div> <h2 id=10-security-considerations>10. Security Considerations<a class=headerlink href=#10-security-considerations title="Permanent link">&para;</a></h2> <h3 id=101-api-key-rotation>10.1 API Key Rotation<a class=headerlink href=#101-api-key-rotation title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1># Rotate API keys in Kubernetes</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>api-keys<span class=w> </span><span class=se>\</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>  </span>--from-literal<span class=o>=</span>gemini-api-key<span class=o>=</span>new-gemini-api-key<span class=w> </span><span class=se>\</span>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>  </span>--from-literal<span class=o>=</span>redis-password<span class=o>=</span>new-redis-password<span class=w> </span><span class=se>\</span>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>  </span>--dry-run<span class=o>=</span>client<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span><span class=p>|</span><span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=c1># Restart pods to apply new keys</span>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>kubectl<span class=w> </span>rollout<span class=w> </span>restart<span class=w> </span>deployment<span class=w> </span>opossum-search
</code></pre></div> <h3 id=102-ssl-configuration>10.2 SSL Configuration<a class=headerlink href=#102-ssl-configuration title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># ingress.yaml for TLS</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-search-ingress</span>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>    </span><span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>    </span><span class=nt>cert-manager.io/cluster-issuer</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span>
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api.opossum-search.com</span>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=w>    </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-search-tls</span>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api.opossum-search.com</span>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=w>    </span><span class=nt>http</span><span class=p>:</span>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=w>      </span><span class=nt>paths</span><span class=p>:</span>
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a><span class=w>        </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a><span class=w>        </span><span class=nt>backend</span><span class=p>:</span>
<a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=w>          </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opossum-search-service</span>
<a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a><span class=w>            </span><span class=nt>port</span><span class=p>:</span>
<a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a><span class=w>              </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
</code></pre></div> <p>This Deployment &amp; Operations Guide provides comprehensive instructions for deploying, configuring, monitoring, and maintaining the Opossum Search platform across various environments. Follow these best practices to ensure reliable operation and optimal performance of your deployment.</p> </div> </div><footer> <div class=rst-footer-buttons role=navigation aria-label="Footer Navigation"> <a href=../../api/getting-started/ class="btn btn-neutral float-left" title="API Reference"><span class="icon icon-circle-arrow-left"></span> Previous</a> <a href=../system-architecture-overview/ class="btn btn-neutral float-right" title="System Overview">Next <span class="icon icon-circle-arrow-right"></span></a> </div> <hr> <div role=contentinfo> <!-- Copyright etc --> </div> Built with <a href=https://www.mkdocs.org/ >MkDocs</a> using a <a href=https://github.com/readthedocs/sphinx_rtd_theme>theme</a> provided by <a href=https://readthedocs.org>Read the Docs</a>. </footer> </div> </div> </section> </div> <div class=rst-versions role=note aria-label=Versions> <span class=rst-current-version data-toggle=rst-current-version> <span><a href=../../api/getting-started/ style="color: #fcfcfc">&laquo; Previous</a></span> <span><a href=../system-architecture-overview/ style="color: #fcfcfc">Next &raquo;</a></span> </span> </div> <script src=../../js/jquery-3.6.0.min.js></script> <script>var base_url = "../..";</script> <script src=../../js/theme_extra.js></script> <script src=../../js/theme.js></script> <script src=../../search/main.js></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 