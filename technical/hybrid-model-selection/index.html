<!DOCTYPE html>
<html class="writer-html5" lang="en"> <head><meta charset="utf-8"/><meta content="IE=edge" http-equiv="X-UA-Compatible"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="bebo" name="author"/><link href="../../img/favicon.ico" rel="shortcut icon"/><title>Hybrid Selection - Opossum Search Documentation</title><link href="../../css/theme.css" rel="stylesheet"/><link href="../../css/theme_extra.css" rel="stylesheet"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/><link href="../../assets/_mkdocstrings.css" rel="stylesheet"/><link href="../../stylesheets/extra.css" rel="stylesheet"/><script>
        // Current page data
        var mkdocs_page_name = "Hybrid Selection";
        var mkdocs_page_input_path = "technical\\hybrid-model-selection.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script><script>hljs.highlightAll();</script></head> <body class="wy-body-for-nav" role="document"> <div class="wy-grid-for-nav"> <nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift"> <div class="wy-side-scroll"> <div class="wy-side-nav-search"> <a class="icon icon-home" href="../.."> Opossum Search Documentation </a><div role="search"> <form action="../../search.html" class="wy-form" id="rtd-search-form" method="get"> <input aria-label="Search docs" name="q" placeholder="Search docs" title="Type search term here" type="text"/> </form> </div> </div> <div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation"> <ul> <li class="toctree-l1"><a class="reference internal" href="../..">Home</a> </li> </ul> <p class="caption"><span class="caption-text">Getting Started</span></p> <ul> <li class="toctree-l1"><a class="reference internal" href="../getting-started/">First Steps</a> </li> <li class="toctree-l1"><a class="reference internal" href="../system-architecture-overview/">System Overview</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../api/getting-started/">API Reference</a> </li> <li class="toctree-l1"><a class="reference internal" href="../devops-guide/">Developer Quickstart</a> </li> </ul> <p class="caption"><span class="caption-text">Core Components</span></p> <ul class="current"> <li class="toctree-l1"><a class="reference internal">Architecture</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../system-architecture-overview/">System Overview</a> </li> <li class="toctree-l2"><a class="reference internal" href="../mcp-architecture/">Model Context Protocol (MCP)</a> </li> <li class="toctree-l2"><a class="reference internal" href="../graphql-api/">GraphQL API</a> </li> <li class="toctree-l2"><a class="reference internal" href="../security-model/">Security Model</a> </li> <li class="toctree-l2"><a class="reference internal" href="../prompt-management/">Prompt Management</a> </li> </ul> </li> <li class="toctree-l1 current"><a class="reference internal current">Model Integration</a> <ul class="current"> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/architecture/">Architecture</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/backend-selection/">Backend Selection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/capability-matrix/">Capability Matrix</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/providers/">Provider Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/configuration/">Configuration</a> </li> <li class="toctree-l2 current"><a class="reference internal current" href="#">Hybrid Selection</a> <ul class="current"> <li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a> </li> <li class="toctree-l3"><a class="reference internal" href="#selection-process-diagram">Selection Process Diagram</a> </li> <li class="toctree-l3"><a class="reference internal" href="#implementation-details">Implementation Details</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#capability-scoring">Capability Scoring</a> </li> <li class="toctree-l4"><a class="reference internal" href="#backend-management">Backend Management</a> </li> <li class="toctree-l4"><a class="reference internal" href="#error-handling">Error Handling</a> </li> <li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#performance-characteristics">Performance Characteristics</a> </li> <li class="toctree-l3"><a class="reference internal" href="#monitoring-and-metrics">Monitoring and Metrics</a> </li> </ul> </li> <li class="toctree-l2"><a class="reference internal" href="../prompt-management/">Prompt Management</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-integration/">DSPy Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-technical/">DSPy Technical Implementation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-examples/">DSPy Usage Examples</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-metrics/">DSPy Metrics &amp; Performance</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Service Availability</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/context-and-scope/">Context and Scope</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/quality-requirements/">Quality Requirements</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/architecture-constraints/">Architecture Constraints</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/availability-monitoring/">Availability Monitoring</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/service-outage/">Error Handling</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Resilience Patterns</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../resilience-patterns/">Core Strategies</a> </li> <li class="toctree-l2"><a class="reference internal" href="../error-handling-resilience/">Error Handling</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/rate-limiting-throttling/">Rate Limiting</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/log-alerts/">Logging and Alerts</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/testing-validation/">Testing and Validation</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">Features</span></p> <ul> <li class="toctree-l1"><a class="reference internal">Conversation</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../conversation/topic-detection/">Topic Detection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/conversation-flow/">Conversation Flow</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/response-generation/">Response Generation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/nlp-components/">NLP Components</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/markov-generation/">Markov Generation</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Image Processing</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/overview/">Overview</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/effects/">Effects and Filters</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/svg-generation/">SVG Generation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/optimization/">Performance Optimization</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../image-processing/caching/">Caching Strategy</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Visualizations &amp; Fun</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../features/service-vizualizations/">Service Visualizations</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/national-day/">National Opossum Day</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/opossum-xenzia/">Opossum Xenzia</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/easter-eggs/">Easter Eggs</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/special-events/">Special Events</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/background-stories/">Background Stories</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">Technical Reference</span></p> <ul> <li class="toctree-l1"><a class="reference internal">Infrastructure</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../redis-caching-architecture/">Redis Caching</a> </li> <li class="toctree-l2"><a class="reference internal" href="../image-processing-pipeline/">Image Pipeline</a> </li> <li class="toctree-l2"><a class="reference internal" href="../opentelemetry-integration/">OpenTelemetry</a> </li> <li class="toctree-l2"><a class="reference internal" href="../svg-markup/">SVG Markup</a> </li> <li class="toctree-l2"><a class="reference internal" href="../bot-user-simulation/">Bot User Simulation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/optimization-strategies/">Optimization Strategies</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/pipeline-optimization/">Pipeline Optimization</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/constraint-mapping/">Constraint Mapping</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">API Documentation</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../api/routes/">Routes</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/request-response/">Request/Response</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/oauth-configuration/">OAuth Configuration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/error-codes/">Error Codes</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/rate-limits/">Rate Limits</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/webhooks/">Webhook Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/health-endpoints/">Health Endpoints</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/compliance/">Compliance</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">DSPy Tutorials</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/getting-started/">Getting Started with DSPy</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/optimizing-prompts/">Optimizing Prompts</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/building-pipelines/">Building Pipelines</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/advanced-reasoning/">Advanced Reasoning</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">About</span></p> <ul> <li class="toctree-l1"><a class="reference internal" href="../../about/history/">Project History</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/opossumial-way/">The Opossumial Way</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/team/">Team</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/roadmap-vision/">Roadmap &amp; Vision</a> </li> </ul> </div> </div> </nav> <section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"> <nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation"> <i class="fa fa-bars" data-toggle="wy-nav-top"></i> <a href="../..">Opossum Search Documentation</a> </nav> <div class="wy-nav-content"> <div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation"> <ul class="wy-breadcrumbs"> <li><a aria-label="Docs" class="icon icon-home" href="../.."></a></li> <li class="breadcrumb-item">Core Components</li> <li class="breadcrumb-item">Model Integration</li> <li class="breadcrumb-item active">Hybrid Selection</li> <li class="wy-breadcrumbs-aside"> </li> </ul> <hr/> </div> <div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main"> <div class="section" itemprop="articleBody"> <h1 id="hybrid-model-architecture">Hybrid Model Architecture<a class="headerlink" href="#hybrid-model-architecture" title="Permanent link">¶</a></h1> <h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2> <p>The hybrid model architecture provides an intelligent layer for combining multiple model backends based on availability, capability, and request requirements. This document outlines the technical implementation and decision-making process.</p> <blockquote> <p><strong>Related Documentation:</strong> - <a href="./">Technical: Hybrid Model Selection System</a> - Detailed technical implementation of the selection algorithm - <a href="../../model-integration/backend-selection/">Model Integration: Backend Selection</a> - Additional details on backend selection criteria - <a href="../redis-caching-architecture/">Technical: Redis Caching Architecture</a> - How Redis supports the hybrid model architecture</p> </blockquote> <h2 id="selection-process-diagram">Selection Process Diagram<a class="headerlink" href="#selection-process-diagram" title="Permanent link">¶</a></h2> <pre class="mermaid"><code>graph TD
    A[Incoming Request] --&gt; B{Has Image?}
    B -- Yes --&gt; C{Gemini Available?}
    C -- Yes --&gt; D[Use Gemini]
    C -- No --&gt; E[Calculate Scores]
    B -- No --&gt; E
    E --&gt; F[Check Gemini Score]
    E --&gt; G[Check Ollama Score]
    E --&gt; H[Check Transformers Score]
    F --&gt; I{Select Best Score}
    G --&gt; I
    H --&gt; I
    I --&gt; J[Initialize Selected Backend]
    J --&gt; K{Success?}
    K -- Yes --&gt; L[Generate Response]
    K -- No --&gt; M[Use Fallback]
    M --&gt; N[Transformers Fallback]

    style D fill:#34a853,color:white
    style N fill:#ea4335,color:white
    style A fill:#4285f4,color:white</code></pre> <h2 id="implementation-details">Implementation Details<a class="headerlink" href="#implementation-details" title="Permanent link">¶</a></h2> <h3 id="capability-scoring">Capability Scoring<a class="headerlink" href="#capability-scoring" title="Permanent link">¶</a></h3> <p>The hybrid model uses a weighted scoring system to evaluate each backend:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">CAPABILITY_WEIGHTS</span> <span class="o">=</span> <span class="p">{</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="s1">'text_processing'</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="s1">'reasoning'</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="s1">'multimodal'</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="s1">'latency'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="s1">'resource_usage'</span><span class="p">:</span> <span class="mf">0.1</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="p">}</span>
</code></pre></div> <p>Each backend is scored based on its capabilities in these areas, with the final selection going to the highest scoring available backend.</p> <h3 id="backend-management">Backend Management<a class="headerlink" href="#backend-management" title="Permanent link">¶</a></h3> <p>Backends are managed through lazy initialization:</p> <ol> <li>Backends are only created when needed</li> <li>Failed backends are not retried until next service check</li> <li>Successful backends are cached for reuse</li> <li>Resource cleanup happens automatically</li> </ol> <h3 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">¶</a></h3> <p>The system implements multiple layers of error handling:</p> <ul> <li>Service availability monitoring</li> <li>Backend initialization retry logic</li> <li>Graceful degradation paths</li> <li>Clear error logging and reporting</li> <li>User-friendly error messages</li> </ul> <h3 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">¶</a></h3> <p>Backend settings are managed through:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">MODEL_CONFIGS</span> <span class="o">=</span> <span class="p">{</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="s2">"gemini-thinking"</span><span class="p">:</span> <span class="p">{</span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>        <span class="s2">"api_name"</span><span class="p">:</span> <span class="s2">"gemini-2.0-flash-thinking-exp-01-21"</span><span class="p">,</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>        <span class="s2">"max_tokens"</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>        <span class="s2">"temperature"</span><span class="p">:</span> <span class="mf">0.7</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>    <span class="p">},</span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>    <span class="s2">"gemma"</span><span class="p">:</span> <span class="p">{</span>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>        <span class="s2">"api_name"</span><span class="p">:</span> <span class="s2">"gemma:2b"</span><span class="p">,</span>
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>        <span class="s2">"transformers_name"</span><span class="p">:</span> <span class="s2">"google/gemma-2b"</span><span class="p">,</span>
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>        <span class="s2">"max_tokens"</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a>        <span class="s2">"temperature"</span><span class="p">:</span> <span class="mf">0.6</span>
<a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a>    <span class="p">}</span>
<a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="p">}</span>
</code></pre></div> <h2 id="performance-characteristics">Performance Characteristics<a class="headerlink" href="#performance-characteristics" title="Permanent link">¶</a></h2> <table> <thead> <tr> <th>Metric</th> <th>Target</th> <th>Actual (P95)</th> </tr> </thead> <tbody> <tr> <td>Backend Selection Time</td> <td>&lt; 50ms</td> <td>35ms</td> </tr> <tr> <td>Initialization Time</td> <td>&lt; 500ms</td> <td>450ms</td> </tr> <tr> <td>Fallback Trigger Time</td> <td>&lt; 2000ms</td> <td>1800ms</td> </tr> <tr> <td>Cache Hit Response Time</td> <td>&lt; 100ms</td> <td>85ms</td> </tr> </tbody> </table> <h2 id="monitoring-and-metrics">Monitoring and Metrics<a class="headerlink" href="#monitoring-and-metrics" title="Permanent link">¶</a></h2> <p>The hybrid implementation exposes several key metrics:</p> <ul> <li>Backend selection times</li> <li>Initialization success rates</li> <li>Fallback frequency</li> <li>Cache hit rates</li> <li>Error rates by backend</li> </ul> <p>These metrics are available through the standard monitoring interfaces and can be used for alerting and optimization.</p> </div> </div><footer> <div aria-label="Footer Navigation" class="rst-footer-buttons" role="navigation"> <a class="btn btn-neutral float-left" href="../../model-integration/configuration/" title="Configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a> <a class="btn btn-neutral float-right" href="../prompt-management/" title="Prompt Management">Next <span class="icon icon-circle-arrow-right"></span></a> </div> <hr/> <div role="contentinfo"> <!-- Copyright etc --> </div> Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. </footer> </div> </div> </section> </div> <div aria-label="Versions" class="rst-versions" role="note"> <span class="rst-current-version" data-toggle="rst-current-version"> <span><a href="../../model-integration/configuration/" style="color: #fcfcfc">« Previous</a></span> <span><a href="../prompt-management/" style="color: #fcfcfc">Next »</a></span> </span> </div> <script src="../../js/jquery-3.6.0.min.js"></script> <script>var base_url = "../..";</script> <script src="../../js/theme_extra.js"></script> <script src="../../js/theme.js"></script> <script src="../../search/main.js"></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 