<!DOCTYPE html>
<html class="writer-html5" lang="en"> <head><meta charset="utf-8"/><meta content="IE=edge" http-equiv="X-UA-Compatible"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="bebo" name="author"/><link href="../../img/favicon.ico" rel="shortcut icon"/><title>Caching Strategy - Opossum Search Documentation</title><link href="../../css/theme.css" rel="stylesheet"/><link href="../../css/theme_extra.css" rel="stylesheet"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/><link href="../../assets/_mkdocstrings.css" rel="stylesheet"/><link href="../../stylesheets/extra.css" rel="stylesheet"/><script>
        // Current page data
        var mkdocs_page_name = "Caching Strategy";
        var mkdocs_page_input_path = "image-processing/caching.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script><script>hljs.highlightAll();</script></head> <body class="wy-body-for-nav" role="document"> <div class="wy-grid-for-nav"> <nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift"> <div class="wy-side-scroll"> <div class="wy-side-nav-search"> <a class="icon icon-home" href="../.."> Opossum Search Documentation </a><div role="search"> <form action="../../search.html" class="wy-form" id="rtd-search-form" method="get"> <input aria-label="Search docs" name="q" placeholder="Search docs" title="Type search term here" type="text"/> </form> </div> </div> <div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation"> <ul> <li class="toctree-l1"><a class="reference internal" href="../..">Home</a> </li> </ul> <p class="caption"><span class="caption-text">Getting Started</span></p> <ul> <li class="toctree-l1"><a class="reference internal" href="../../technical/getting-started/">First Steps</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../technical/system-architecture-overview/">System Overview</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../api/getting-started/">API Reference</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../technical/devops-guide/">Developer Quickstart</a> </li> </ul> <p class="caption"><span class="caption-text">Core Components</span></p> <ul> <li class="toctree-l1"><a class="reference internal">Architecture</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../technical/system-architecture-overview/">System Overview</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/mcp-architecture/">Model Context Protocol (MCP)</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/graphql-api/">GraphQL API</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/security-model/">Security Model</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/prompt-management/">Prompt Management</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Model Integration</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/architecture/">Architecture</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/backend-selection/">Backend Selection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/capability-matrix/">Capability Matrix</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/providers/">Provider Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/configuration/">Configuration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/hybrid-model-selection/">Hybrid Selection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/prompt-management/">Prompt Management</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-integration/">DSPy Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-technical/">DSPy Technical Implementation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-examples/">DSPy Usage Examples</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../model-integration/dspy-metrics/">DSPy Metrics &amp; Performance</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Service Availability</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/context-and-scope/">Context and Scope</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/quality-requirements/">Quality Requirements</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/architecture-constraints/">Architecture Constraints</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/availability-monitoring/">Availability Monitoring</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/service-outage/">Error Handling</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Resilience Patterns</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../technical/resilience-patterns/">Core Strategies</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/error-handling-resilience/">Error Handling</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/rate-limiting-throttling/">Rate Limiting</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/log-alerts/">Logging and Alerts</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../service-availability/testing-validation/">Testing and Validation</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">Features</span></p> <ul class="current"> <li class="toctree-l1"><a class="reference internal">Conversation</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../conversation/topic-detection/">Topic Detection</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/conversation-flow/">Conversation Flow</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/response-generation/">Response Generation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/nlp-components/">NLP Components</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../conversation/markov-generation/">Markov Generation</a> </li> </ul> </li> <li class="toctree-l1 current"><a class="reference internal current">Image Processing</a> <ul class="current"> <li class="toctree-l2"><a class="reference internal" href="../overview/">Overview</a> </li> <li class="toctree-l2"><a class="reference internal" href="../effects/">Effects and Filters</a> </li> <li class="toctree-l2"><a class="reference internal" href="../svg-generation/">SVG Generation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../optimization/">Performance Optimization</a> </li> <li class="toctree-l2 current"><a class="reference internal current" href="#">Caching Strategy</a> <ul class="current"> <li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a> </li> <li class="toctree-l3"><a class="reference internal" href="#caching-architecture">Caching Architecture</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#cache-tiers">Cache Tiers</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#cache-categories">Cache Categories</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#1-result-caching">1. Result Caching</a> </li> <li class="toctree-l4"><a class="reference internal" href="#2-intermediate-result-caching">2. Intermediate Result Caching</a> </li> <li class="toctree-l4"><a class="reference internal" href="#3-resource-caching">3. Resource Caching</a> </li> <li class="toctree-l4"><a class="reference internal" href="#4-thumbnail-caching">4. Thumbnail Caching</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#cache-key-generation">Cache Key Generation</a> </li> <li class="toctree-l3"><a class="reference internal" href="#ttl-strategies">TTL Strategies</a> </li> <li class="toctree-l3"><a class="reference internal" href="#cache-invalidation-strategies">Cache Invalidation Strategies</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#time-based-invalidation">Time-Based Invalidation</a> </li> <li class="toctree-l4"><a class="reference internal" href="#explicit-invalidation">Explicit Invalidation</a> </li> <li class="toctree-l4"><a class="reference internal" href="#version-based-invalidation">Version-Based Invalidation</a> </li> <li class="toctree-l4"><a class="reference internal" href="#lrulfu-policies">LRU/LFU Policies</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#performance-metrics">Performance Metrics</a> <ul> <li class="toctree-l4"><a class="reference internal" href="#cache-hit-rates">Cache Hit Rates</a> </li> <li class="toctree-l4"><a class="reference internal" href="#latency-improvements">Latency Improvements</a> </li> </ul> </li> <li class="toctree-l3"><a class="reference internal" href="#cache-storage-sizing">Cache Storage Sizing</a> </li> <li class="toctree-l3"><a class="reference internal" href="#integration-with-redis">Integration with Redis</a> </li> <li class="toctree-l3"><a class="reference internal" href="#cache-warming-strategies">Cache Warming Strategies</a> </li> <li class="toctree-l3"><a class="reference internal" href="#cache-analytics-and-monitoring">Cache Analytics and Monitoring</a> </li> <li class="toctree-l3"><a class="reference internal" href="#configuration-options">Configuration Options</a> </li> <li class="toctree-l3"><a class="reference internal" href="#related-documentation">Related Documentation</a> </li> </ul> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">Visualizations &amp; Fun</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../features/service-vizualizations/">Service Visualizations</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/national-day/">National Opossum Day</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/opossum-xenzia/">Opossum Xenzia</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/easter-eggs/">Easter Eggs</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/special-events/">Special Events</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../features/background-stories/">Background Stories</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">Technical Reference</span></p> <ul> <li class="toctree-l1"><a class="reference internal">Infrastructure</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../technical/redis-caching-architecture/">Redis Caching</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/image-processing-pipeline/">Image Pipeline</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/opentelemetry-integration/">OpenTelemetry</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/svg-markup/">SVG Markup</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../technical/bot-user-simulation/">Bot User Simulation</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/optimization-strategies/">Optimization Strategies</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/pipeline-optimization/">Pipeline Optimization</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../infrastructure/constraint-mapping/">Constraint Mapping</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">API Documentation</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../api/routes/">Routes</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/request-response/">Request/Response</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/oauth-configuration/">OAuth Configuration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/error-codes/">Error Codes</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/rate-limits/">Rate Limits</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/webhooks/">Webhook Integration</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/health-endpoints/">Health Endpoints</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../api/compliance/">Compliance</a> </li> </ul> </li> <li class="toctree-l1"><a class="reference internal">DSPy Tutorials</a> <ul> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/getting-started/">Getting Started with DSPy</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/optimizing-prompts/">Optimizing Prompts</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/building-pipelines/">Building Pipelines</a> </li> <li class="toctree-l2"><a class="reference internal" href="../../tutorials/dspy/advanced-reasoning/">Advanced Reasoning</a> </li> </ul> </li> </ul> <p class="caption"><span class="caption-text">About</span></p> <ul> <li class="toctree-l1"><a class="reference internal" href="../../about/history/">Project History</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/opossumial-way/">The Opossumial Way</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/team/">Team</a> </li> <li class="toctree-l1"><a class="reference internal" href="../../about/roadmap-vision/">Roadmap &amp; Vision</a> </li> </ul> </div> </div> </nav> <section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"> <nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation"> <i class="fa fa-bars" data-toggle="wy-nav-top"></i> <a href="../..">Opossum Search Documentation</a> </nav> <div class="wy-nav-content"> <div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation"> <ul class="wy-breadcrumbs"> <li><a aria-label="Docs" class="icon icon-home" href="../.."></a></li> <li class="breadcrumb-item">Features</li> <li class="breadcrumb-item">Image Processing</li> <li class="breadcrumb-item active">Caching Strategy</li> <li class="wy-breadcrumbs-aside"> </li> </ul> <hr/> </div> <div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main"> <div class="section" itemprop="articleBody"> <h1 id="caching-strategy">Caching Strategy<a class="headerlink" href="#caching-strategy" title="Permanent link">¶</a></h1> <h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2> <p>The Opossum Search image processing system implements a sophisticated multi-tiered caching architecture to optimize performance, reduce resource consumption, and improve response times. This document details the caching strategies used throughout the image processing pipeline.</p> <div class="admonition note"> <p class="admonition-title">Note</p> </div> <p>Effective caching is crucial for maintaining high performance in image processing. This document outlines the caching architecture and strategies used in Opossum Search.</p> <h2 id="caching-architecture">Caching Architecture<a class="headerlink" href="#caching-architecture" title="Permanent link">¶</a></h2> <p>The caching system employs a layered approach to maximize efficiency across different types of operations and data:</p> <pre class="mermaid"><code>graph TD
    A[Client Request] --&gt; B{Cache Hit?}
    B --&gt;|Yes| C[Return Cached Result]
    B --&gt;|No| D[Process Request]
    D --&gt; E[Store in Cache]
    E --&gt; F[Return Result]

    subgraph "Cache Layers"
    G[Memory Cache]
    H[Redis Cache]
    I[Disk Cache]
    J[CDN Cache]
    end

    B -.-&gt; G
    B -.-&gt; H
    B -.-&gt; I
    B -.-&gt; J

    E -.-&gt; G
    E -.-&gt; H
    E -.-&gt; I
    E -.-&gt; J</code></pre> <h3 id="cache-tiers">Cache Tiers<a class="headerlink" href="#cache-tiers" title="Permanent link">¶</a></h3> <table> <thead> <tr> <th>Cache Tier</th> <th>Storage Medium</th> <th>Access Speed</th> <th>Capacity</th> <th>Persistence</th> <th>Use Case</th> </tr> </thead> <tbody> <tr> <td>L1: Memory</td> <td>RAM</td> <td>&lt;1ms</td> <td>Limited</td> <td>None</td> <td>Frequently accessed small results</td> </tr> <tr> <td>L2: Redis</td> <td>Redis Cluster</td> <td>1-5ms</td> <td>Medium</td> <td>Configurable</td> <td>Shared results across instances</td> </tr> <tr> <td>L3: Disk</td> <td>Local SSD</td> <td>5-20ms</td> <td>Large</td> <td>Full</td> <td>Larger results, backup layer</td> </tr> <tr> <td>L4: CDN</td> <td>Distributed</td> <td>Variable</td> <td>Very Large</td> <td>Extended</td> <td>Public, static results</td> </tr> </tbody> </table> <h2 id="cache-categories">Cache Categories<a class="headerlink" href="#cache-categories" title="Permanent link">¶</a></h2> <p>The system implements specialized caching for different types of processed content:</p> <h3 id="1-result-caching">1. Result Caching<a class="headerlink" href="#1-result-caching" title="Permanent link">¶</a></h3> <p>Stores complete processing results based on input parameters:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_processed_image</span><span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="n">operations</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="c1"># Generate cache key from parameters</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="n">cache_key</span> <span class="o">=</span> <span class="n">generate_cache_key</span><span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="n">operations</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="c1"># Check if result exists in cache</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="n">cached_result</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="k">if</span> <span class="n">cached_result</span><span class="p">:</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>        <span class="k">return</span> <span class="n">cached_result</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="c1"># Process image if not in cache</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">process_image</span><span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="n">operations</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="c1"># Store in cache with appropriate TTL</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a>        <span class="n">key</span><span class="o">=</span><span class="n">cache_key</span><span class="p">,</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a>        <span class="n">value</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a>        <span class="n">ttl</span><span class="o">=</span><span class="n">calculate_ttl</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="p">)</span>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div> <h3 id="2-intermediate-result-caching">2. Intermediate Result Caching<a class="headerlink" href="#2-intermediate-result-caching" title="Permanent link">¶</a></h3> <p>Caches partial results to optimize multi-step processing chains:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_filter_chain</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">filters</span><span class="p">):</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">image</span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span class="n">last_cached_state</span> <span class="o">=</span> <span class="kc">None</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">filter_op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filters</span><span class="p">):</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>        <span class="c1"># Generate intermediate cache key</span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>        <span class="n">intermediate_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">image</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">:step</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">filter_op</span><span class="o">.</span><span class="n">hash</span><span class="si">}</span><span class="s2">"</span>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>        <span class="c1"># Try to retrieve from cache</span>
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>        <span class="n">cached_state</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">intermediate_key</span><span class="p">)</span>
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a>        <span class="k">if</span> <span class="n">cached_state</span><span class="p">:</span>
<a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">cached_state</span>
<a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a>            <span class="n">last_cached_state</span> <span class="o">=</span> <span class="n">i</span>
<a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a>            <span class="k">continue</span>
<a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a>
<a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a>        <span class="c1"># Apply filter and cache result</span>
<a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">apply_filter</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">filter_op</span><span class="p">)</span>
<a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a>        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a>            <span class="n">key</span><span class="o">=</span><span class="n">intermediate_key</span><span class="p">,</span>
<a href="#__codelineno-1-20" id="__codelineno-1-20" name="__codelineno-1-20"></a>            <span class="n">value</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
<a href="#__codelineno-1-21" id="__codelineno-1-21" name="__codelineno-1-21"></a>            <span class="n">ttl</span><span class="o">=</span><span class="n">INTERMEDIATE_CACHE_TTL</span>
<a href="#__codelineno-1-22" id="__codelineno-1-22" name="__codelineno-1-22"></a>        <span class="p">)</span>
<a href="#__codelineno-1-23" id="__codelineno-1-23" name="__codelineno-1-23"></a>
<a href="#__codelineno-1-24" id="__codelineno-1-24" name="__codelineno-1-24"></a>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div> <h3 id="3-resource-caching">3. Resource Caching<a class="headerlink" href="#3-resource-caching" title="Permanent link">¶</a></h3> <p>Caches frequently used resources like filters, presets, and templates:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_filter_preset</span><span class="p">(</span><span class="n">preset_name</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span class="c1"># Generate cache key</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>    <span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="ow">or</span> <span class="n">CURRENT_VERSION</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>    <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"preset:</span><span class="si">{</span><span class="n">preset_name</span><span class="si">}</span><span class="s2">:v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">"</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>    <span class="c1"># Check cache</span>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>    <span class="n">cached_preset</span> <span class="o">=</span> <span class="n">resource_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>    <span class="k">if</span> <span class="n">cached_preset</span><span class="p">:</span>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>        <span class="k">return</span> <span class="n">cached_preset</span>
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a>    <span class="c1"># Load preset from storage</span>
<a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a>    <span class="n">preset</span> <span class="o">=</span> <span class="n">load_preset_from_storage</span><span class="p">(</span><span class="n">preset_name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
<a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a>
<a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a>    <span class="c1"># Cache with long TTL</span>
<a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a>    <span class="n">resource_cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a>        <span class="n">key</span><span class="o">=</span><span class="n">cache_key</span><span class="p">,</span>
<a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a>        <span class="n">value</span><span class="o">=</span><span class="n">preset</span><span class="p">,</span>
<a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a>        <span class="n">ttl</span><span class="o">=</span><span class="n">RESOURCE_CACHE_TTL</span>  <span class="c1"># Typically 24+ hours</span>
<a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a>    <span class="p">)</span>
<a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a>
<a href="#__codelineno-2-21" id="__codelineno-2-21" name="__codelineno-2-21"></a>    <span class="k">return</span> <span class="n">preset</span>
</code></pre></div> <h3 id="4-thumbnail-caching">4. Thumbnail Caching<a class="headerlink" href="#4-thumbnail-caching" title="Permanent link">¶</a></h3> <p>Specialized caching for generated thumbnails and previews:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_thumbnail</span><span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"webp"</span><span class="p">):</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"thumb:</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">"</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="c1"># Check cache</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span class="n">cached_thumb</span> <span class="o">=</span> <span class="n">thumbnail_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>    <span class="k">if</span> <span class="n">cached_thumb</span><span class="p">:</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>        <span class="k">return</span> <span class="n">cached_thumb</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>    <span class="c1"># Generate thumbnail</span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>    <span class="n">original</span> <span class="o">=</span> <span class="n">load_image</span><span class="p">(</span><span class="n">image_id</span><span class="p">)</span>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="n">thumbnail</span> <span class="o">=</span> <span class="n">resize_image</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>    <span class="k">if</span> <span class="nb">format</span> <span class="o">!=</span> <span class="n">original</span><span class="o">.</span><span class="n">format</span><span class="p">:</span>
<a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a>        <span class="n">thumbnail</span> <span class="o">=</span> <span class="n">convert_format</span><span class="p">(</span><span class="n">thumbnail</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
<a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a>
<a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a>    <span class="c1"># Cache with relatively long TTL</span>
<a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a>    <span class="n">thumbnail_cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
<a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a>        <span class="n">key</span><span class="o">=</span><span class="n">cache_key</span><span class="p">,</span>
<a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a>        <span class="n">value</span><span class="o">=</span><span class="n">thumbnail</span><span class="p">,</span>
<a href="#__codelineno-3-20" id="__codelineno-3-20" name="__codelineno-3-20"></a>        <span class="n">ttl</span><span class="o">=</span><span class="n">THUMBNAIL_CACHE_TTL</span>  <span class="c1"># Typically 7+ days</span>
<a href="#__codelineno-3-21" id="__codelineno-3-21" name="__codelineno-3-21"></a>    <span class="p">)</span>
<a href="#__codelineno-3-22" id="__codelineno-3-22" name="__codelineno-3-22"></a>
<a href="#__codelineno-3-23" id="__codelineno-3-23" name="__codelineno-3-23"></a>    <span class="k">return</span> <span class="n">thumbnail</span>
</code></pre></div> <h2 id="cache-key-generation">Cache Key Generation<a class="headerlink" href="#cache-key-generation" title="Permanent link">¶</a></h2> <p>The system uses deterministic cache key generation to ensure consistency:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_cache_key</span><span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="n">operations</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="sd">"""Generate a deterministic cache key for image operations"""</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>    <span class="c1"># Base components</span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a>    <span class="n">components</span> <span class="o">=</span> <span class="p">[</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>        <span class="sa">f</span><span class="s2">"img:</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>        <span class="sa">f</span><span class="s2">"v:</span><span class="si">{</span><span class="n">IMAGE_PROCESSING_VERSION</span><span class="si">}</span><span class="s2">"</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>    <span class="p">]</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="c1"># Add normalized operation signatures</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a>    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
<a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a>        <span class="n">op_signature</span> <span class="o">=</span> <span class="n">normalize_operation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
<a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a>        <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"op:</span><span class="si">{</span><span class="n">op_signature</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a>
<a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span class="c1"># Add normalized options</span>
<a href="#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a href="#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a>        <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"opt:</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">normalize_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a>
<a href="#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a>    <span class="c1"># Generate hash for the full key</span>
<a href="#__codelineno-4-20" id="__codelineno-4-20" name="__codelineno-4-20"></a>    <span class="n">full_key</span> <span class="o">=</span> <span class="s2">":"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
<a href="#__codelineno-4-21" id="__codelineno-4-21" name="__codelineno-4-21"></a>    <span class="n">hashed_key</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">full_key</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<a href="#__codelineno-4-22" id="__codelineno-4-22" name="__codelineno-4-22"></a>
<a href="#__codelineno-4-23" id="__codelineno-4-23" name="__codelineno-4-23"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"img_proc:</span><span class="si">{</span><span class="n">hashed_key</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div> <h2 id="ttl-strategies">TTL Strategies<a class="headerlink" href="#ttl-strategies" title="Permanent link">¶</a></h2> <p>Different cache items have different time-to-live (TTL) values based on their characteristics:</p> <table> <thead> <tr> <th>Content Type</th> <th>Default TTL</th> <th>Rationale</th> </tr> </thead> <tbody> <tr> <td>Final Results</td> <td>24 hours</td> <td>Balance between freshness and efficiency</td> </tr> <tr> <td>Intermediate Results</td> <td>1 hour</td> <td>Temporary computation savings</td> </tr> <tr> <td>Thumbnails</td> <td>7 days</td> <td>Rarely change, high request frequency</td> </tr> <tr> <td>Resources</td> <td>24-48 hours</td> <td>Static content with version checks</td> </tr> <tr> <td>Error Results</td> <td>5 minutes</td> <td>Prevent repeated processing of problematic inputs</td> </tr> </tbody> </table> <p>TTLs are dynamically adjusted based on:</p> <ul> <li>Resource constraints (lower TTLs when storage is limited)</li> <li>Usage patterns (longer TTLs for frequently accessed items)</li> <li>Content type (images vs. generated SVGs)</li> <li>Processing complexity (longer TTLs for expensive operations)</li> </ul> <h2 id="cache-invalidation-strategies">Cache Invalidation Strategies<a class="headerlink" href="#cache-invalidation-strategies" title="Permanent link">¶</a></h2> <h3 id="time-based-invalidation">Time-Based Invalidation<a class="headerlink" href="#time-based-invalidation" title="Permanent link">¶</a></h3> <p>The primary invalidation mechanism is time-based expiration through TTLs.</p> <h3 id="explicit-invalidation">Explicit Invalidation<a class="headerlink" href="#explicit-invalidation" title="Permanent link">¶</a></h3> <div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">invalidate_image_caches</span><span class="p">(</span><span class="n">image_id</span><span class="p">):</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="sd">"""Invalidate all caches related to a specific image"""</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>    <span class="c1"># Pattern-based invalidation in Redis</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>    <span class="n">redis_client</span><span class="o">.</span><span class="n">delete_by_pattern</span><span class="p">(</span><span class="sa">f</span><span class="s2">"img_proc:*:img:</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">:*"</span><span class="p">)</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>    <span class="c1"># Clear from memory cache</span>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>    <span class="n">memory_cache</span><span class="o">.</span><span class="n">delete_by_pattern</span><span class="p">(</span><span class="sa">f</span><span class="s2">"*</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">*"</span><span class="p">)</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>    <span class="c1"># Mark for disk cache cleanup</span>
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>    <span class="n">disk_cache</span><span class="o">.</span><span class="n">mark_for_cleanup</span><span class="p">(</span><span class="n">image_id</span><span class="p">)</span>
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>    <span class="c1"># Purge from CDN if applicable</span>
<a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a>    <span class="k">if</span> <span class="n">cdn_enabled</span><span class="p">:</span>
<a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a>        <span class="n">cdn_client</span><span class="o">.</span><span class="n">purge_object</span><span class="p">(</span><span class="sa">f</span><span class="s2">"images/</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">/*"</span><span class="p">)</span>
</code></pre></div> <h3 id="version-based-invalidation">Version-Based Invalidation<a class="headerlink" href="#version-based-invalidation" title="Permanent link">¶</a></h3> <p>Cache keys include version information to automatically invalidate when:</p> <ul> <li>Processing algorithms change</li> <li>New filters are added</li> <li>Quality improvements are implemented</li> </ul> <div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># When the algorithm version changes</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">IMAGE_PROCESSING_VERSION</span> <span class="o">=</span> <span class="s2">"2.5.0"</span>  <span class="c1"># Included in all cache keys</span>
</code></pre></div> <h3 id="lrulfu-policies">LRU/LFU Policies<a class="headerlink" href="#lrulfu-policies" title="Permanent link">¶</a></h3> <p>Different cache tiers implement appropriate eviction policies:</p> <table> <thead> <tr> <th>Cache Tier</th> <th>Primary Policy</th> <th>Secondary Policy</th> </tr> </thead> <tbody> <tr> <td>Memory</td> <td>LRU (Least Recently Used)</td> <td>Size limit</td> </tr> <tr> <td>Redis</td> <td>LFU (Least Frequently Used)</td> <td>TTL</td> </tr> <tr> <td>Disk</td> <td>FIFO with size limits</td> <td>Manual purge</td> </tr> <tr> <td>CDN</td> <td>TTL</td> <td>None</td> </tr> </tbody> </table> <h2 id="performance-metrics">Performance Metrics<a class="headerlink" href="#performance-metrics" title="Permanent link">¶</a></h2> <h3 id="cache-hit-rates">Cache Hit Rates<a class="headerlink" href="#cache-hit-rates" title="Permanent link">¶</a></h3> <table> <thead> <tr> <th>Cache Type</th> <th>Target Hit Rate</th> <th>Observed Hit Rate</th> </tr> </thead> <tbody> <tr> <td>Result Cache</td> <td>&gt;60%</td> <td>65-75%</td> </tr> <tr> <td>Intermediate Cache</td> <td>&gt;40%</td> <td>45-55%</td> </tr> <tr> <td>Thumbnail Cache</td> <td>&gt;80%</td> <td>85-95%</td> </tr> <tr> <td>Resource Cache</td> <td>&gt;95%</td> <td>98-99%</td> </tr> </tbody> </table> <h3 id="latency-improvements">Latency Improvements<a class="headerlink" href="#latency-improvements" title="Permanent link">¶</a></h3> <table> <thead> <tr> <th>Operation</th> <th>Uncached Latency</th> <th>Cached Latency</th> <th>Improvement</th> </tr> </thead> <tbody> <tr> <td>Basic Filter</td> <td>100-200ms</td> <td>5-15ms</td> <td>93-95%</td> </tr> <tr> <td>Filter Chain</td> <td>300-800ms</td> <td>10-30ms</td> <td>96-97%</td> </tr> <tr> <td>SVG Generation</td> <td>500-2000ms</td> <td>15-50ms</td> <td>97-98%</td> </tr> <tr> <td>Image Analysis</td> <td>1000-3000ms</td> <td>20-70ms</td> <td>98-99%</td> </tr> </tbody> </table> <h2 id="cache-storage-sizing">Cache Storage Sizing<a class="headerlink" href="#cache-storage-sizing" title="Permanent link">¶</a></h2> <p>Guidelines for allocating cache storage:</p> <table> <thead> <tr> <th>Traffic Level</th> <th>Memory Cache</th> <th>Redis Cache</th> <th>Disk Cache</th> </tr> </thead> <tbody> <tr> <td>Low (&lt;100k req/day)</td> <td>1-2GB</td> <td>5-10GB</td> <td>20-50GB</td> </tr> <tr> <td>Medium (100k-1M req/day)</td> <td>4-8GB</td> <td>20-50GB</td> <td>100-200GB</td> </tr> <tr> <td>High (1M+ req/day)</td> <td>16-32GB</td> <td>100-200GB</td> <td>500GB-1TB</td> </tr> </tbody> </table> <h2 id="integration-with-redis">Integration with Redis<a class="headerlink" href="#integration-with-redis" title="Permanent link">¶</a></h2> <p>The Redis cache implementation leverages specialized data structures:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">RedisCacheManager</span><span class="p">:</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">redis_client</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">"img_proc"</span><span class="p">):</span>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_client</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace</span>
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">        </span><span class="sd">"""Retrieve an item from cache"""</span>
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a>        <span class="n">full_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">"</span>
<a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a>
<a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a>        <span class="c1"># Get value and metadata</span>
<a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a>        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
<a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a>        <span class="n">pipeline</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_key</span><span class="p">)</span>
<a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a>        <span class="n">pipeline</span><span class="o">.</span><span class="n">hgetall</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">full_key</span><span class="si">}</span><span class="s2">:meta"</span><span class="p">)</span>
<a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a>        <span class="n">value</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a>
<a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
<a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a>            <span class="k">return</span> <span class="kc">None</span>
<a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a>
<a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a>        <span class="c1"># Update access metrics</span>
<a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hincrby</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">full_key</span><span class="si">}</span><span class="s2">:meta"</span><span class="p">,</span> <span class="s2">"access_count"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a href="#__codelineno-7-21" id="__codelineno-7-21" name="__codelineno-7-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">full_key</span><span class="si">}</span><span class="s2">:meta"</span><span class="p">,</span> <span class="s2">"last_access"</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
<a href="#__codelineno-7-22" id="__codelineno-7-22" name="__codelineno-7-22"></a>
<a href="#__codelineno-7-23" id="__codelineno-7-23" name="__codelineno-7-23"></a>        <span class="c1"># Deserialize value</span>
<a href="#__codelineno-7-24" id="__codelineno-7-24" name="__codelineno-7-24"></a>        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a href="#__codelineno-7-25" id="__codelineno-7-25" name="__codelineno-7-25"></a>
<a href="#__codelineno-7-26" id="__codelineno-7-26" name="__codelineno-7-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">86400</span><span class="p">):</span>
<a href="#__codelineno-7-27" id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">        </span><span class="sd">"""Store an item in cache with metadata"""</span>
<a href="#__codelineno-7-28" id="__codelineno-7-28" name="__codelineno-7-28"></a>        <span class="n">full_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">"</span>
<a href="#__codelineno-7-29" id="__codelineno-7-29" name="__codelineno-7-29"></a>
<a href="#__codelineno-7-30" id="__codelineno-7-30" name="__codelineno-7-30"></a>        <span class="c1"># Serialize value</span>
<a href="#__codelineno-7-31" id="__codelineno-7-31" name="__codelineno-7-31"></a>        <span class="n">serialized</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a href="#__codelineno-7-32" id="__codelineno-7-32" name="__codelineno-7-32"></a>
<a href="#__codelineno-7-33" id="__codelineno-7-33" name="__codelineno-7-33"></a>        <span class="c1"># Store value and metadata</span>
<a href="#__codelineno-7-34" id="__codelineno-7-34" name="__codelineno-7-34"></a>        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
<a href="#__codelineno-7-35" id="__codelineno-7-35" name="__codelineno-7-35"></a>        <span class="n">pipeline</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span><span class="n">full_key</span><span class="p">,</span> <span class="n">ttl</span><span class="p">,</span> <span class="n">serialized</span><span class="p">)</span>
<a href="#__codelineno-7-36" id="__codelineno-7-36" name="__codelineno-7-36"></a>
<a href="#__codelineno-7-37" id="__codelineno-7-37" name="__codelineno-7-37"></a>        <span class="c1"># Store metadata for analytics and management</span>
<a href="#__codelineno-7-38" id="__codelineno-7-38" name="__codelineno-7-38"></a>        <span class="n">pipeline</span><span class="o">.</span><span class="n">hmset</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">full_key</span><span class="si">}</span><span class="s2">:meta"</span><span class="p">,</span> <span class="p">{</span>
<a href="#__codelineno-7-39" id="__codelineno-7-39" name="__codelineno-7-39"></a>            <span class="s2">"created_at"</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<a href="#__codelineno-7-40" id="__codelineno-7-40" name="__codelineno-7-40"></a>            <span class="s2">"size_bytes"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">serialized</span><span class="p">),</span>
<a href="#__codelineno-7-41" id="__codelineno-7-41" name="__codelineno-7-41"></a>            <span class="s2">"ttl"</span><span class="p">:</span> <span class="n">ttl</span><span class="p">,</span>
<a href="#__codelineno-7-42" id="__codelineno-7-42" name="__codelineno-7-42"></a>            <span class="s2">"access_count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a href="#__codelineno-7-43" id="__codelineno-7-43" name="__codelineno-7-43"></a>            <span class="s2">"last_access"</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a href="#__codelineno-7-44" id="__codelineno-7-44" name="__codelineno-7-44"></a>        <span class="p">})</span>
<a href="#__codelineno-7-45" id="__codelineno-7-45" name="__codelineno-7-45"></a>        <span class="n">pipeline</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">full_key</span><span class="si">}</span><span class="s2">:meta"</span><span class="p">,</span> <span class="n">ttl</span><span class="p">)</span>
<a href="#__codelineno-7-46" id="__codelineno-7-46" name="__codelineno-7-46"></a>
<a href="#__codelineno-7-47" id="__codelineno-7-47" name="__codelineno-7-47"></a>        <span class="n">pipeline</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<a href="#__codelineno-7-48" id="__codelineno-7-48" name="__codelineno-7-48"></a>
<a href="#__codelineno-7-49" id="__codelineno-7-49" name="__codelineno-7-49"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_by_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
<a href="#__codelineno-7-50" id="__codelineno-7-50" name="__codelineno-7-50"></a><span class="w">        </span><span class="sd">"""Delete all keys matching a pattern"""</span>
<a href="#__codelineno-7-51" id="__codelineno-7-51" name="__codelineno-7-51"></a>        <span class="n">full_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">"</span>
<a href="#__codelineno-7-52" id="__codelineno-7-52" name="__codelineno-7-52"></a>
<a href="#__codelineno-7-53" id="__codelineno-7-53" name="__codelineno-7-53"></a>        <span class="c1"># Find all matching keys</span>
<a href="#__codelineno-7-54" id="__codelineno-7-54" name="__codelineno-7-54"></a>        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">full_pattern</span><span class="p">)</span>
<a href="#__codelineno-7-55" id="__codelineno-7-55" name="__codelineno-7-55"></a>        <span class="n">meta_keys</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:meta"</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
<a href="#__codelineno-7-56" id="__codelineno-7-56" name="__codelineno-7-56"></a>
<a href="#__codelineno-7-57" id="__codelineno-7-57" name="__codelineno-7-57"></a>        <span class="c1"># Delete keys and metadata</span>
<a href="#__codelineno-7-58" id="__codelineno-7-58" name="__codelineno-7-58"></a>        <span class="k">if</span> <span class="n">keys</span><span class="p">:</span>
<a href="#__codelineno-7-59" id="__codelineno-7-59" name="__codelineno-7-59"></a>            <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
<a href="#__codelineno-7-60" id="__codelineno-7-60" name="__codelineno-7-60"></a>            <span class="n">pipeline</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">)</span>
<a href="#__codelineno-7-61" id="__codelineno-7-61" name="__codelineno-7-61"></a>            <span class="k">if</span> <span class="n">meta_keys</span><span class="p">:</span>
<a href="#__codelineno-7-62" id="__codelineno-7-62" name="__codelineno-7-62"></a>                <span class="n">pipeline</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="o">*</span><span class="n">meta_keys</span><span class="p">)</span>
<a href="#__codelineno-7-63" id="__codelineno-7-63" name="__codelineno-7-63"></a>            <span class="n">pipeline</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</code></pre></div> <h2 id="cache-warming-strategies">Cache Warming Strategies<a class="headerlink" href="#cache-warming-strategies" title="Permanent link">¶</a></h2> <p>The system implements proactive cache warming to improve performance:</p> <ol> <li><strong>Predictive Warming</strong>: Analyzes usage patterns to pre-cache likely-to-be-requested variants</li> <li><strong>Background Warming</strong>: Fills caches during low-traffic periods</li> <li><strong>Related Content Warming</strong>: When one variant is requested, preemptively caches related variants</li> </ol> <div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">warm_cache_for_popular_images</span><span class="p">(</span><span class="n">top_n</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="sd">"""Warm cache for most popular images with common operations"""</span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>    <span class="c1"># Get most frequently accessed images</span>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>    <span class="n">popular_images</span> <span class="o">=</span> <span class="n">analytics</span><span class="o">.</span><span class="n">get_top_images</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">top_n</span><span class="p">)</span>
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>
<a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a>    <span class="c1"># Common operations to pre-cache</span>
<a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a>    <span class="n">common_operations</span> <span class="o">=</span> <span class="p">[</span>
<a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a>        <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"resize"</span><span class="p">,</span> <span class="s2">"width"</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span> <span class="s2">"height"</span><span class="p">:</span> <span class="mi">600</span><span class="p">},</span>
<a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a>        <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"thumbnail"</span><span class="p">,</span> <span class="s2">"size"</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
<a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a>        <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"grayscale"</span><span class="p">},</span>
<a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a>        <span class="c1"># More common operations</span>
<a href="#__codelineno-8-13" id="__codelineno-8-13" name="__codelineno-8-13"></a>    <span class="p">]</span>
<a href="#__codelineno-8-14" id="__codelineno-8-14" name="__codelineno-8-14"></a>
<a href="#__codelineno-8-15" id="__codelineno-8-15" name="__codelineno-8-15"></a>    <span class="c1"># Queue cache warming tasks</span>
<a href="#__codelineno-8-16" id="__codelineno-8-16" name="__codelineno-8-16"></a>    <span class="k">for</span> <span class="n">image_id</span> <span class="ow">in</span> <span class="n">popular_images</span><span class="p">:</span>
<a href="#__codelineno-8-17" id="__codelineno-8-17" name="__codelineno-8-17"></a>        <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">common_operations</span><span class="p">:</span>
<a href="#__codelineno-8-18" id="__codelineno-8-18" name="__codelineno-8-18"></a>            <span class="n">task_queue</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span>
<a href="#__codelineno-8-19" id="__codelineno-8-19" name="__codelineno-8-19"></a>                <span class="n">warm_image_cache</span><span class="p">,</span>
<a href="#__codelineno-8-20" id="__codelineno-8-20" name="__codelineno-8-20"></a>                <span class="n">image_id</span><span class="o">=</span><span class="n">image_id</span><span class="p">,</span>
<a href="#__codelineno-8-21" id="__codelineno-8-21" name="__codelineno-8-21"></a>                <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
<a href="#__codelineno-8-22" id="__codelineno-8-22" name="__codelineno-8-22"></a>                <span class="n">priority</span><span class="o">=</span><span class="s2">"low"</span>  <span class="c1"># Don't interfere with user requests</span>
<a href="#__codelineno-8-23" id="__codelineno-8-23" name="__codelineno-8-23"></a>            <span class="p">)</span>
</code></pre></div> <h2 id="cache-analytics-and-monitoring">Cache Analytics and Monitoring<a class="headerlink" href="#cache-analytics-and-monitoring" title="Permanent link">¶</a></h2> <p>The system collects detailed cache performance metrics:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CacheAnalytics</span><span class="p">:</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">        </span><span class="sd">"""Collect and report cache performance metrics"""</span>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>            <span class="s2">"memory_cache"</span><span class="p">:</span> <span class="p">{</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>                <span class="s2">"size"</span><span class="p">:</span> <span class="n">memory_cache</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span>
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a>                <span class="s2">"item_count"</span><span class="p">:</span> <span class="n">memory_cache</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a>                <span class="s2">"hit_rate"</span><span class="p">:</span> <span class="n">memory_cache</span><span class="o">.</span><span class="n">hit_rate</span><span class="p">(),</span>
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>                <span class="s2">"miss_rate"</span><span class="p">:</span> <span class="n">memory_cache</span><span class="o">.</span><span class="n">miss_rate</span><span class="p">(),</span>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>                <span class="s2">"eviction_rate"</span><span class="p">:</span> <span class="n">memory_cache</span><span class="o">.</span><span class="n">eviction_rate</span><span class="p">(),</span>
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a>                <span class="s2">"avg_ttl"</span><span class="p">:</span> <span class="n">memory_cache</span><span class="o">.</span><span class="n">avg_ttl</span><span class="p">()</span>
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>            <span class="p">},</span>
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a>            <span class="s2">"redis_cache"</span><span class="p">:</span> <span class="p">{</span>
<a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a>                <span class="s2">"size"</span><span class="p">:</span> <span class="n">redis_cache</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span>
<a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a>                <span class="s2">"item_count"</span><span class="p">:</span> <span class="n">redis_cache</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
<a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a>                <span class="s2">"hit_rate"</span><span class="p">:</span> <span class="n">redis_cache</span><span class="o">.</span><span class="n">hit_rate</span><span class="p">(),</span>
<a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a>                <span class="s2">"miss_rate"</span><span class="p">:</span> <span class="n">redis_cache</span><span class="o">.</span><span class="n">miss_rate</span><span class="p">(),</span>
<a href="#__codelineno-9-18" id="__codelineno-9-18" name="__codelineno-9-18"></a>                <span class="s2">"eviction_rate"</span><span class="p">:</span> <span class="n">redis_cache</span><span class="o">.</span><span class="n">eviction_rate</span><span class="p">(),</span>
<a href="#__codelineno-9-19" id="__codelineno-9-19" name="__codelineno-9-19"></a>                <span class="s2">"avg_ttl"</span><span class="p">:</span> <span class="n">redis_cache</span><span class="o">.</span><span class="n">avg_ttl</span><span class="p">(),</span>
<a href="#__codelineno-9-20" id="__codelineno-9-20" name="__codelineno-9-20"></a>                <span class="s2">"memory_usage"</span><span class="p">:</span> <span class="n">redis_cache</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">()</span>
<a href="#__codelineno-9-21" id="__codelineno-9-21" name="__codelineno-9-21"></a>            <span class="p">},</span>
<a href="#__codelineno-9-22" id="__codelineno-9-22" name="__codelineno-9-22"></a>            <span class="c1"># Similar metrics for other cache tiers</span>
<a href="#__codelineno-9-23" id="__codelineno-9-23" name="__codelineno-9-23"></a>        <span class="p">}</span>
<a href="#__codelineno-9-24" id="__codelineno-9-24" name="__codelineno-9-24"></a>
<a href="#__codelineno-9-25" id="__codelineno-9-25" name="__codelineno-9-25"></a>        <span class="c1"># Report to monitoring system</span>
<a href="#__codelineno-9-26" id="__codelineno-9-26" name="__codelineno-9-26"></a>        <span class="n">monitoring</span><span class="o">.</span><span class="n">report_metrics</span><span class="p">(</span><span class="s2">"cache_performance"</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
<a href="#__codelineno-9-27" id="__codelineno-9-27" name="__codelineno-9-27"></a>
<a href="#__codelineno-9-28" id="__codelineno-9-28" name="__codelineno-9-28"></a>        <span class="c1"># Log periodic summary</span>
<a href="#__codelineno-9-29" id="__codelineno-9-29" name="__codelineno-9-29"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Cache performance summary: hit_rate=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">'redis_cache'</span><span class="p">][</span><span class="s1">'hit_rate'</span><span class="p">]</span><span class="si">}</span><span class="s2">%, "</span>
<a href="#__codelineno-9-30" id="__codelineno-9-30" name="__codelineno-9-30"></a>                   <span class="sa">f</span><span class="s2">"size=</span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">'redis_cache'</span><span class="p">][</span><span class="s1">'size'</span><span class="p">]</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">MB"</span><span class="p">)</span>
</code></pre></div> <h2 id="configuration-options">Configuration Options<a class="headerlink" href="#configuration-options" title="Permanent link">¶</a></h2> <p>The caching system is highly configurable:</p> <div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># Example configuration</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="nt">caching</span><span class="p">:</span>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span><span class="c1"># Global settings</span>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span><span class="nt">log_level</span><span class="p">:</span><span class="w"> </span><span class="s">"info"</span>
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">  </span><span class="c1"># Memory cache</span>
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">  </span><span class="nt">memory_cache</span><span class="p">:</span>
<a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">    </span><span class="nt">max_size</span><span class="p">:</span><span class="w"> </span><span class="s">"2GB"</span>
<a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">    </span><span class="nt">ttl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600</span><span class="w">  </span><span class="c1"># seconds</span>
<a href="#__codelineno-10-12" id="__codelineno-10-12" name="__codelineno-10-12"></a>
<a href="#__codelineno-10-13" id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">  </span><span class="c1"># Redis cache</span>
<a href="#__codelineno-10-14" id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">  </span><span class="nt">redis_cache</span><span class="p">:</span>
<a href="#__codelineno-10-15" id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-10-16" id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">"redis.example.com"</span>
<a href="#__codelineno-10-17" id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379</span>
<a href="#__codelineno-10-18" id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">    </span><span class="nt">db</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a href="#__codelineno-10-19" id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">    </span><span class="nt">ttl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">86400</span><span class="w">  </span><span class="c1"># seconds</span>
<a href="#__codelineno-10-20" id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="w">    </span><span class="nt">max_memory</span><span class="p">:</span><span class="w"> </span><span class="s">"50GB"</span>
<a href="#__codelineno-10-21" id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="w">    </span><span class="nt">eviction_policy</span><span class="p">:</span><span class="w"> </span><span class="s">"lfu"</span>
<a href="#__codelineno-10-22" id="__codelineno-10-22" name="__codelineno-10-22"></a>
<a href="#__codelineno-10-23" id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">  </span><span class="c1"># Disk cache</span>
<a href="#__codelineno-10-24" id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">  </span><span class="nt">disk_cache</span><span class="p">:</span>
<a href="#__codelineno-10-25" id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-10-26" id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">"/var/cache/opossum_images"</span>
<a href="#__codelineno-10-27" id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">    </span><span class="nt">max_size</span><span class="p">:</span><span class="w"> </span><span class="s">"200GB"</span>
<a href="#__codelineno-10-28" id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="w">    </span><span class="nt">cleanup_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3600</span><span class="w">  </span><span class="c1"># seconds</span>
</code></pre></div> <div class="admonition tip"> <p class="admonition-title">Tip</p> </div> <p>Properly configuring the caching system is essential for achieving optimal performance. Adjust the cache sizes, TTLs, and eviction policies based on your specific workload and resource constraints.</p> <h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">¶</a></h2> <ul> <li>Image Processing Overview</li> <li>Effects and Filters</li> <li>SVG Generation</li> <li>Performance Optimization</li> <li>Infrastructure Optimization Strategies</li> </ul> </div> </div><footer> <div aria-label="Footer Navigation" class="rst-footer-buttons" role="navigation"> <a class="btn btn-neutral float-left" href="../optimization/" title="Performance Optimization"><span class="icon icon-circle-arrow-left"></span> Previous</a> <a class="btn btn-neutral float-right" href="../../features/service-vizualizations/" title="Service Visualizations">Next <span class="icon icon-circle-arrow-right"></span></a> </div> <hr/> <div role="contentinfo"> <!-- Copyright etc --> </div> Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. </footer> </div> </div> </section> </div> <div aria-label="Versions" class="rst-versions" role="note"> <span class="rst-current-version" data-toggle="rst-current-version"> <span><a href="../optimization/" style="color: #fcfcfc">« Previous</a></span> <span><a href="../../features/service-vizualizations/" style="color: #fcfcfc">Next »</a></span> </span> </div> <script src="../../js/jquery-3.6.0.min.js"></script> <script>var base_url = "../..";</script> <script src="../../js/theme_extra.js"></script> <script src="../../js/theme.js"></script> <script src="../../search/main.js"></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 